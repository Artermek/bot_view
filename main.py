import asyncio
import redis
import os
import json
import uuid
import base64
from fastapi import FastAPI, HTTPException, UploadFile, File
from fastapi.responses import JSONResponse, FileResponse
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
from typing import Dict, List, Optional
from openai import AsyncOpenAI
import markdown
from pathlib import Path
from datetime import datetime
from weasyprint import HTML

import textwrap

from fastapi.responses import JSONResponse

app = FastAPI()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
REDIS_URL = os.getenv("REDISCLOUD_URL")
redis_pool = redis.ConnectionPool.from_url(REDIS_URL, decode_responses=True)  # –æ–¥–∏–Ω –ø—É–ª –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å
redis_client = redis.Redis(connection_pool=redis_pool)

# –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —Ö—Ä–∞–Ω–∏–º –æ–¥–Ω—É –∑–∞–¥–∞—á—É –≤ Redis (–ø–æ‚ÄØ—É–º–æ–ª—á–∞–Ω–∏—é 12 —á)
TASK_TTL_SECONDS = int(os.getenv("TASK_TTL_SECONDS", "43200"))  # 12¬†—á

class SurveyData(BaseModel):
    childName: str
    childDOB: str
    childGender: str
    parentName: str
    q1_1: str
    q1_2: str
    q1_3: str
    q1_4: str
    q1_5: str
    q1_6: str
    q1_7: str
    q1_8: str
    q1_9: str
    q1_10: str
    q2_1: str
    q2_2: str
    q2_3: str
    q2_4: str
    q2_5: str
    q2_6: str
    q2_7: str
    q2_8: str
    q2_9: str
    q2_10: str
    q3_1: str
    q3_2: str
    q3_3: str
    q3_4: str
    q3_5: str
    q3_6: str
    q3_7: str
    q3_8: str
    q3_9: str
    q3_10: str
    q4_1: str
    q4_2: str
    q4_3: str
    q4_4: str
    q4_5: str
    q4_6: str
    q4_7: str
    q4_8: str
    q4_9: str
    q4_10: str
    emotionalState: str
    developmentFeatures: Optional[str] = None
    strengths: Optional[str] = None
    attentionAreas: Optional[str] = None
    specialists: Optional[str] = None

class AnalysisRequest(BaseModel):
    survey: SurveyData
    task_id: str
    


# –ü—Ä–æ–º–ø—Ç –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´–î–æ–º, –î–µ—Ä–µ–≤–æ, –ß–µ–ª–æ–≤–µ–∫¬ª
PROMPT_HOUSE_TREE_PERSON = """–ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π ‚Äî —Å–∫–∞–Ω –∏–ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —Ä–∏—Å—É–Ω–∫–∞ –Ω–∞ —Ç–µ–º—É ¬´–î–æ–º, –¥–µ—Ä–µ–≤–æ, —á–µ–ª–æ–≤–µ–∫¬ª. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –≤ –¥–≤–∞ —ç—Ç–∞–ø–∞:
—Å–Ω–∞—á–∞–ª–∞ –∏–∑–º–µ—Ä–∏—Ç—å –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∑–∞—Ç–µ–º –æ—Ç–Ω–µ—Å—Ç–∏ –∫–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫ –æ–¥–Ω–æ–º—É –∏–∑ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤.
–í –æ—Ç–≤–µ—Ç–µ —É–∫–∞–∂–∏ —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –≠—Ç–∞–ø–∞ 2. 


–≠—Ç–∞–ø 1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –∑–∞–º–µ—Ä—å –∏–ª–∏ –æ—Ü–µ–Ω–∏—Ç—å –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö (–∏–ª–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç –æ–±—ä–µ–∫—Ç–∞/–ª–∏—Å—Ç–∞):
‚Äî –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Ä–∏—Å—É–Ω–∫–∞ (–ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∏—Å—Ç–∞)
‚Äî –¢–æ–ª—â–∏–Ω—É –ª–∏–Ω–∏–π (—Å—Ä–µ–¥–Ω—è—è —à–∏—Ä–∏–Ω–∞ —à—Ç—Ä–∏—Ö–∞ –≤ –º–º)
‚Äî –ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ª–∏—Å—Ç–∞ –∏–ª–∏ ¬´—Å–ª–µ–≤–∞/–≤ —Ü–µ–Ω—Ç—Ä–µ/—Å–ø—Ä–∞–≤–∞¬ª)
‚Äî –î–ª—è –¥–æ–º–∞: —à–∏—Ä–∏–Ω–∞ –∏ –≤—ã—Å–æ—Ç–∞ –∫–æ—Ä–ø—É—Å–∞, —Ä–∞–∑–º–µ—Ä—ã –∫—Ä—ã—à–∏, —Ä–∞–∑–º–µ—Ä—ã –¥–≤–µ—Ä–∏ –∏ –æ–∫–æ–Ω, –Ω–∞–ª–∏—á–∏–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞ (–ª–∏–Ω–∏—è –∑–µ–º–ª–∏)
‚Äî –î–ª—è –¥–µ—Ä–µ–≤–∞: –≤—ã—Å–æ—Ç–∞ —Å—Ç–≤–æ–ª–∞, –¥–ª–∏–Ω–∞ –∫–æ—Ä–Ω–µ–π, —Ä–∞–∑–º–µ—Ä—ã –∫—Ä–æ–Ω—ã
‚Äî –î–ª—è —á–µ–ª–æ–≤–µ–∫–∞: —Ä–æ—Å—Ç, —à–∏—Ä–∏–Ω–∞ –ø–ª–µ—á, –¥–ª–∏–Ω–∞ —Ä—É–∫, –¥–ª–∏–Ω–∞ –Ω–æ–≥, —Ä–∞–∑–º–µ—Ä –≥–æ–ª–æ–≤—ã

–≠—Ç–∞–ø 2. –ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–Ø –ü–û –ö–†–ò–¢–ï–†–ò–Ø–ú
–ò—Å–ø–æ–ª—å–∑—É—è –∏–∑–º–µ—Ä–µ–Ω–Ω—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –≤—ã–±–µ—Ä–∏ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –∫—Ä–∏—Ç–µ—Ä–∏–π, —É–∫–∞–∂–∏ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ, —É—Å–ª–æ–≤–∏–µ –≤—ã–±–æ—Ä–∞ (–ø–æ—Ä–æ–≥–æ–≤—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã) –∏ –Ω–∞ —á—Ç–æ —ç—Ç–æ—Ç –∫—Ä–∏—Ç–µ—Ä–∏–π –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ. –ü—Ä–∏–≤–µ–¥–∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Ü–∏—Ñ—Ä–∞–º–∏.

–û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–∏—Å—É–Ω–∫–∞:

–†–∞–∑–º–µ—Ä —Ä–∏—Å—É–Ω–∫–∞:
–ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä (—Ä–∏—Å—É–Ω–æ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç >65 % –ª–∏—Å—Ç–∞). –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —ç–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—é, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ, —ç–∫—Å–ø–∞–Ω—Å–∏–≤–Ω–æ—Å—Ç—å, –∏–Ω–æ–≥–¥–∞ ‚Äì –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ø—Ä–∏–∑–Ω–∞–Ω–∏–∏ –∏–ª–∏ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â—É—é –≥–∏–≥–∞–Ω—Ç–æ–º–∞–Ω–∏—é.
–ú–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä (—Ä–∏—Å—É–Ω–æ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç <65 % –ª–∏—Å—Ç–∞). –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∏–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—é, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞—Å—Ç–µ–Ω—á–∏–≤–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–æ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å.

–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ª–∏—Å—Ç–µ:
–í —Ü–µ–Ω—Ç—Ä–µ (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 40‚Äì60 % –ø–æ —à–∏—Ä–∏–Ω–µ –∏ 40‚Äì60 % –ø–æ –≤—ã—Å–æ—Ç–µ). –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, —É—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ø—Ä–∏–∑–Ω–∞–Ω–∏–∏.
–°–≤–µ—Ä—Ö—É (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ ‚â•70 %). –§–∞–Ω—Ç–∞–∑–∏–∏, –∏–¥–µ–∞–ª–∏–∑–º, –æ—Ç–æ—Ä–≤–∞–Ω–Ω–æ—Å—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.
–°–Ω–∏–∑—É (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ ‚â§30 %). –ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–ø–æ—Ä–µ.
–°–ª–µ–≤–∞ (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ ‚â§30 %). –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ—à–ª–æ–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –º–∞—Ç–µ—Ä–∏, –∏–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è.
–°–ø—Ä–∞–≤–∞ (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ ‚â•70 %). –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –±—É–¥—É—â–µ–µ, —ç–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –æ—Ç—Ü–∞.

–°–∏–ª–∞ –Ω–∞–∂–∏–º–∞:
–°–∏–ª—å–Ω—ã–π –Ω–∞–∂–∏–º (—Å—Ä–µ–¥–Ω—è—è —à–∏—Ä–∏–Ω–∞ —à—Ç—Ä–∏—Ö–∞ >1 –º–º). –≠–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å, –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –∏–Ω–æ–≥–¥–∞ ‚Äì –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å.
–°–ª–∞–±—ã–π –Ω–∞–∂–∏–º (—à—Ç—Ä–∏—Ö <1 –º–º). –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –º—è–≥–∫–æ—Å—Ç—å, —É—Å—Ç—É–ø—á–∏–≤–æ—Å—Ç—å, –∞—Å—Ç–µ–Ω–∏—è, —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å.

–•–∞—Ä–∞–∫—Ç–µ—Ä –ª–∏–Ω–∏–π:
–ß–µ—Ç–∫–∏–µ, —Ä–æ–≤–Ω—ã–µ –ª–∏–Ω–∏–∏ (–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏ ‚â•15 –º–º, ‚â§2 —Ä–∞–∑—Ä—ã–≤–∞ –Ω–∞ 20 –º–º, –≤–∞—Ä—å–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—â–∏–Ω—ã <20 %). –ö–æ–Ω—Ç—Ä–æ–ª—å, —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.
–ü—Ä–µ—Ä—ã–≤–∏—Å—Ç—ã–µ, –Ω–µ—Ä–æ–≤–Ω—ã–µ –ª–∏–Ω–∏–∏ (—Å–µ–≥–º–µ–Ω—Ç ‚â§10 –º–º, ‚â•5 —Ä–∞–∑—Ä—ã–≤–æ–≤ –Ω–∞ 20 –º–º, ‚â•5 —Ä–µ–∑–∫–∏—Ö –∏–∑–ª–æ–º–æ–≤ >30¬∞). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å.
–ó–∞—à—Ç—Ä–∏—Ö–æ–≤–∞–Ω–Ω—ã–µ, –∑–∞—Ç–µ–º–Ω—ë–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏ (—Ö–µ—Ç—á–∏–Ω–≥ ‚â•5 –ª–∏–Ω–∏–π –Ω–∞ 10 –º–º, —à—Ç—Ä–∏—Ö–æ–≤–∫–∞ ‚â•20 % –∫–æ–Ω—Ç—É—Ä–∞). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–µ —ç–º–æ—Ü–∏–∏.

–û–±—â–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è:
–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (–∫–∞–∂–¥—ã–π –∏–∑ 4 –∫–≤–∞–¥—Ä–∞–Ω—Ç–æ–≤ –ª–∏—Å—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç 15‚Äì35 % —Ä–∏—Å—É–Ω–∫–∞, —Ü–µ–Ω—Ç—Ä –º–∞—Å—Å —Å–º–µ—â—ë–Ω ‚â§10 %). –£—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω–æ—Å—Ç—å, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å.
–ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–∞—è, —Ö–∞–æ—Ç–∏—á–Ω–∞—è (–æ–¥–∏–Ω –∫–≤–∞–¥—Ä–∞–Ω—Ç ‚â•50 %, —Å–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ ‚â•20 %, ‚â•6 –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –ª–∏–Ω–∏–π –Ω–∞ 50 –º–º¬≤). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç.
–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è (—Ä–∏—Å—É–Ω–æ–∫ ‚â§30 % –ø–ª–æ—â–∞–¥–∏ –ª–∏—Å—Ç–∞, ‚â•40 % –ø—É—Å—Ç–æ, –æ–±—ä–µ–∫—Ç–æ–≤ ‚â§3). –ò–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–æ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞.

–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å—É–Ω–∫–∞ ¬´–î–æ–º–∞¬ª:

–§—É–Ω–¥–∞–º–µ–Ω—Ç:
–ù–∞–ª–∏—á–∏–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞ (–ª–∏–Ω–∏—è ‚â•80 % —à–∏—Ä–∏–Ω—ã –¥–æ–º–∞, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.8 –º–º, –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–æ–≤). –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å.
–°–ª–∞–±—ã–π, –Ω–µ—á–µ—Ç–∫–∏–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç (–ª–∏–Ω–∏—è –ø—Ä–µ—Ä—ã–≤–∏—Å—Ç–∞ ‚â•3 —Ä–∞–∑—Ä—ã–≤–∞ –Ω–∞ 50 –º–º –∏–ª–∏ —Ç–æ–ª—â–∏–Ω–∞ <0.5 –º–º). –ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–ø–æ—Ä–µ.
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞ (–Ω–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏). –û—Ç—á—É–∂–¥—ë–Ω–Ω–æ—Å—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å.

–°—Ç–µ–Ω—ã:
–ö—Ä–µ–ø–∫–∏–µ —Å—Ç–µ–Ω—ã (–∫–æ–Ω—Ç—É—Ä –∑–∞–º–∫–Ω—É—Ç, ‚â§1 —Ä–∞–∑—Ä—ã–≤ –Ω–∞ 100 –º–º, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.8 –º–º). –°–∏–ª—å–Ω–æ–µ ‚Äú–Ø‚Äù, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.
–°–ª–∞–±—ã–µ, —Ç–æ–Ω–∫–∏–µ —Å—Ç–µ–Ω—ã (—Ç–æ–ª—â–∏–Ω–∞ <0.5 –º–º, ‚â•3 —Ä–∞–∑—Ä—ã–≤–∞ –Ω–∞ 50 –º–º). –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —É—è–∑–≤–∏–º–æ—Å—Ç—å.
–ó–∞—à—Ç—Ä–∏—Ö–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–µ–Ω—ã (—à—Ç—Ä–∏—Ö–æ–≤–∫–∞ ‚â•5 –ª–∏–Ω–∏–π –Ω–∞ 10 –º–º, ‚â•20 % –ø–ª–æ—â–∞–¥–∏). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã.

–ö—Ä—ã—à–∞:
–ë–æ–ª—å—à–∞—è –∫—Ä—ã—à–∞ (–≤—ã—Å–æ—Ç–∞ ‚â•25 % –≤—ã—Å–æ—Ç—ã –¥–æ–º–∞, —Å–≤–µ—Å ‚â•90 % —à–∏—Ä–∏–Ω—ã). –†–∞–∑–≤–∏—Ç–∞—è —Ñ–∞–Ω—Ç–∞–∑–∏—è, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã.
–ú–∞–ª–µ–Ω—å–∫–∞—è –∫—Ä—ã—à–∞ (–≤—ã—Å–æ—Ç–∞ ‚â§10 %, —Å–≤–µ—Å ‚â§70 %). –†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ—Å—Ç—å —Ñ–∞–Ω—Ç–∞–∑–∏–∏.
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä—ã—à–∏ (–Ω–µ—Ç —Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã—Ö/—Å–∫–∞—Ç–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤). –ò–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—è.

–î–≤–µ—Ä—å:
–ë–æ–ª—å—à–∞—è –¥–≤–µ—Ä—å (–≤—ã—Å–æ—Ç–∞ ‚â•25 %, —à–∏—Ä–∏–Ω–∞ ‚â•15 %, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.8 –º–º). –≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏.
–ú–∞–ª–µ–Ω—å–∫–∞—è –¥–≤–µ—Ä—å (–≤—ã—Å–æ—Ç–∞ ‚â§15 %, —à–∏—Ä–∏–Ω–∞ ‚â§10 %, —Ç–æ–ª—â–∏–Ω–∞ <0.8 –º–º). –ò–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è, –∑–∞–º–∫–Ω—É—Ç–æ—Å—Ç—å.
–ó–∞–∫—Ä—ã—Ç–∞—è –¥–≤–µ—Ä—å (–∫–æ–Ω—Ç—É—Ä –∑–∞–º–∫–Ω—É—Ç, –±–µ–∑ —â–µ–ª–∏). –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å.
–î–≤–µ—Ä—å –±–µ–∑ —Ä—É—á–∫–∏ (–Ω–µ—Ç –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ —Ä—É—á–∫–∏ 2‚Äì5 –º–º). –ù–µ–∂–µ–ª–∞–Ω–∏–µ –æ–±—â–∞—Ç—å—Å—è.

–û–∫–Ω–∞:
–ë–æ–ª—å—à–∏–µ –æ–∫–Ω–∞ (‚â•20 % –≤—ã—Å–æ—Ç—ã –∏ —à–∏—Ä–∏–Ω—ã –∫–æ—Ä–ø—É—Å–∞, –ø–ª–æ—â–∞–¥—å ‚â•4 % —Ñ–∞—Å–∞–¥–∞). –ò–Ω—Ç–µ—Ä–µ—Å –∫ –º–∏—Ä—É, –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
–ú–∞–ª–µ–Ω—å–∫–∏–µ –æ–∫–Ω–∞ (‚â§10 %, –ø–ª–æ—â–∞–¥—å ‚â§1.5 %). –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ –º–∏—Ä—É.
–ó–∞–Ω–∞–≤–µ—Å–∫–∏ (‚â•3 –ø–∞—Ä–∞–ª–ª–µ–ª–µ–π ‚â•5 –º–º, –ø–ª–æ—Ç–Ω–æ—Å—Ç—å ‚â•3 –ª–∏–Ω–∏–∏/–æ–∫–Ω–æ). –ñ–µ–ª–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç—å—Å—è.
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–∫–æ–Ω (–Ω–µ—Ç –∑–∞–º–∫–Ω—É—Ç—ã—Ö –∫–æ–Ω—Ç—É—Ä–æ–≤). –ò–∑–æ–ª—è—Ü–∏—è, –æ—Ç—á—É–∂–¥–µ–Ω–Ω–æ—Å—Ç—å.

–î—ã–º –∏–∑ —Ç—Ä—É–±—ã:
–î—ã–º –ª—ë–≥–∫–∏–π (1‚Äì5 –ª–∏–Ω–∏–π ‚â•10 –º–º, —Ç–æ–ª—â–∏–Ω–∞ <0.8 –º–º). –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ç–µ–ø–ª–æ—Ç–∞, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –±–ª–∏–∑–æ—Å—Ç–∏.
–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π –¥—ã–º (‚â•6 –ª–∏–Ω–∏–π, –ø–ª–æ—Ç–Ω–æ—Å—Ç—å ‚â•5/10 –º–º, —à—Ç—Ä–∏—Ö–æ–≤–∫–∞ ‚â•15 %). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—ã–º–∞ (–Ω–µ—Ç –ª–∏–Ω–∏–π). –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–π.
–î–æ–º –±–µ–∑ —Ç—Ä—É–±—ã (–Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ ‚â•5√ó3 –º–º). –û—Ç–æ—Ä–≤–∞–Ω–Ω–æ—Å—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏, —Ñ–∞–Ω—Ç–∞–∑–∏–∏.

–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å—É–Ω–∫–∞ ¬´–î–µ—Ä–µ–≤–∞¬ª:

–ö–æ—Ä–Ω–∏:
–ù–∞–ª–∏—á–∏–µ –∫–æ—Ä–Ω–µ–π (–ª–∏–Ω–∏–∏ ‚â•5 –º–º, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.5 –º–º, —à–∏—Ä–∏–Ω–∞ ‚â•20 % –¥–∏–∞–º–µ—Ç—Ä–∞ —Å—Ç–≤–æ–ª–∞). –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —Å–≤—è–∑—å —Å –ø—Ä–æ—à–ª—ã–º.
–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–µ –∫–æ—Ä–Ω–∏ (‚â•3 –ª–∏–Ω–∏–∏ ‚â•8 –º–º, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.8 –º–º, —à—Ç—Ä–∏—Ö–æ–≤–∫–∞ ‚â•5/10 –º–º). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –∑–∞—â–∏—Ç–µ.
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ—Ä–Ω–µ–π. –ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –æ—Ç–æ—Ä–≤–∞–Ω–Ω–æ—Å—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.

–°—Ç–≤–æ–ª:
–ö—Ä–µ–ø–∫–∏–π —Å—Ç–≤–æ–ª (—à–∏—Ä–∏–Ω–∞ ‚â•15 % –≤—ã—Å–æ—Ç—ã, –∫–æ–Ω—Ç—É—Ä –∑–∞–º–∫–Ω—É—Ç, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.8 –º–º, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ ‚â§5¬∞). –°–∏–ª–∞ ‚Äú–Ø‚Äù, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.
–¢–æ–Ω–∫–∏–π —Å—Ç–≤–æ–ª (—à–∏—Ä–∏–Ω–∞ <10 %, —Ç–æ–ª—â–∏–Ω–∞ <0.5 –º–º, ‚â•2 —Ä–∞–∑—Ä—ã–≤–∞ –Ω–∞ 50 –º–º). –•—Ä—É–ø–∫–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
–ò—Å–∫—Ä–∏–≤–ª—ë–Ω–Ω—ã–π —Å—Ç–≤–æ–ª (‚â•2 –∏–∑–≥–∏–±–∞ ‚â•15¬∞). –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏.
–†–∞–Ω—ã/–¥—É–ø–ª–∞ (–∑–∞–º–∫–Ω—É—Ç—ã–π –∫–æ–Ω—Ç—É—Ä ‚â•3√ó3 –º–º + —à—Ç—Ä–∏—Ö–æ–≤–∫–∞ ‚â•3/10 –º–º). –¢—Ä–∞–≤–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–ø—ã—Ç.

–í–µ—Ç–≤–∏:
–ü–æ–¥–Ω—è—Ç—ã–µ –≤–≤–µ—Ä—Ö (‚â•50 % –≤–µ—Ç–≤–µ–π –ø–æ–¥ —É–≥–ª–æ–º +30‚Ä¶+90¬∞, –¥–ª–∏–Ω–∞ ‚â•15 –º–º). –û–ø—Ç–∏–º–∏–∑–º, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é.
–û–ø—É—â–µ–Ω–Ω—ã–µ –≤–Ω–∏–∑ (‚â•50 % –≤–µ—Ç–≤–µ–π –ø–æ–¥ —É–≥–ª–æ–º ‚Äì30‚Ä¶‚Äì90¬∞, —Ç–æ–ª—â–∏–Ω–∞ <0.6 –º–º). –ü–µ—Å—Å–∏–º–∏–∑–º, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å.
–ö–æ–ª—é—á–∏–µ (–Ω–∞ –∫–∞–∂–¥–æ–π –≤–µ—Ç–≤–∏ ‚â•3 —à–∏–ø–∞ ‚â§5 –º–º). –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å, –∑–∞—â–∏—Ç–∞.
–û–±—Ä—É–±–ª–µ–Ω–Ω—ã–µ (‚â•2 ¬´—Å—Ä–µ–∑–∞¬ª ‚â§3 –º–º). –ß—É–≤—Å—Ç–≤–æ —É—Ç—Ä–∞—Ç—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.

–ö—Ä–æ–Ω–∞:
–ü—ã—à–Ω–∞—è (–∫–æ–Ω—Ç—É—Ä ‚â•25 % –≤—ã—Å–æ—Ç—ã, —à–∏—Ä–∏–Ω–∞ ‚â•120 % —Å—Ç–≤–æ–ª–∞, ‚â•15 —à—Ç—Ä–∏—Ö–æ–≤—ã—Ö ¬´–ª–∏–Ω–∏–π¬ª, –ø–ª–æ—Ç–Ω–æ—Å—Ç—å ‚â•4/10 –º–º¬≤). –†–∞–∑–≤–∏—Ç–∞—è —Ñ–∞–Ω—Ç–∞–∑–∏—è, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ.
–ù–µ–±–æ–ª—å—à–∞—è (–∫–æ–Ω—Ç—É—Ä ‚â§10 %, —à–∏—Ä–∏–Ω–∞ ‚â§80 %, ‚â§8 –ª–∏—Å—Ç—å–µ–≤, –ø–ª–æ—Ç–Ω–æ—Å—Ç—å ‚â§2/10 –º–º¬≤). –†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ—Å—Ç—å —Ñ–∞–Ω—Ç–∞–∑–∏–∏.
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä–æ–Ω—ã. –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ø–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å.

–ü–ª–æ–¥—ã/–ª–∏—Å—Ç—å—è:
–ï—Å—Ç—å (‚â•5 –∑–∞–º–∫–Ω—É—Ç—ã—Ö –∫–æ–Ω—Ç—É—Ä–æ–≤ ‚â•5 –º–º¬≤, –∑–æ–Ω–∞ ‚â•10 % –∫—Ä–æ–Ω—ã). –ü–ª–æ–¥–æ—Ç–≤–æ—Ä–Ω–æ—Å—Ç—å, —Ä–µ—Å—É—Ä—Å–Ω–æ—Å—Ç—å.
–ù–µ—Ç. –ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç—å, –æ—â—É—â–µ–Ω–∏–µ –Ω–µ—Ö–≤–∞—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.

–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å—É–Ω–∫–∞ ¬´–ß–µ–ª–æ–≤–µ–∫–∞¬ª:

–ì–æ–ª–æ–≤–∞:
–ë–æ–ª—å—à–∞—è (–≤—ã—Å–æ—Ç–∞ ‚â•25 % —Ñ–∏–≥—É—Ä—ã, —à–∏—Ä–∏–Ω–∞ ‚â•30 % –ø–ª–µ—á, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.7 –º–º). –í—ã—Å–æ–∫–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∞–º–±–∏—Ü–∏–∏.
–°—Ä–µ–¥–Ω—è—è (15‚Äì25 %, 20‚Äì30 %, —Ç–æ–ª—â–∏–Ω–∞ 0.5‚Äì0.7 –º–º). –ê–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å.
–ú–∞–ª–µ–Ω—å–∫–∞—è (‚â§15 %, ‚â§20 %, —Ç–æ–ª—â–∏–Ω–∞ <0.5 –º–º). –ù–∏–∑–∫–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ø–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å.

–ì–ª–∞–∑–∞:
–ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–µ (–∫–æ–Ω—Ç—É—Ä ‚â•10 % –≤—ã—Å–æ—Ç—ã –∏ —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã, –∑—Ä–∞—á–æ–∫ ‚â•2 –º–º, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.6 –º–º). –ò–Ω—Ç–µ—Ä–µ—Å –∫ –º–∏—Ä—É, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏.
–ó–∞–∫—Ä—ã—Ç—ã–µ (–ª–∏–Ω–∏–∏ ‚â•8 –º–º, —Ç–æ–ª—â–∏–Ω–∞ ‚â§0.5 –º–º, –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –¥–µ—Ç–∞–ª–∏). –ò–∑–±–µ–≥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞, —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å.

–£—à–∏:
–ë–æ–ª—å—à–∏–µ (–∫–æ–Ω—Ç—É—Ä ‚â•20 % –≤—ã—Å–æ—Ç—ã –≥–æ–ª–æ–≤—ã, ‚â•10 % —à–∏—Ä–∏–Ω—ã, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.6 –º–º). –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤–æ –≤–Ω–∏–º–∞–Ω–∏–∏, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –∫—Ä–∏—Ç–∏–∫–µ.
–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∑–∞–º–∫–Ω—É—Ç–æ—Å—Ç—å.

–¢–µ–ª–æ (–ø–ª–µ—á–∏/–º—É—Å–∫—É–ª—ã):
–®–∏—Ä–æ–∫–∏–µ –ø–ª–µ—á–∏ (–º–µ–∂–¥—É –∫—Ä–∞—è–º–∏ ‚â•25 % –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã, ‚â•50 % —à–∏—Ä–∏–Ω—ã —Ç—É–ª–æ–≤–∏—â–∞). –°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –≤–ª–∞—Å—Ç–∏, –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏—é.
–£–∑–∫–∏–µ –ø–ª–µ—á–∏ (‚â§15 % –≤—ã—Å–æ—Ç—ã, ‚â§30 % —à–∏—Ä–∏–Ω—ã —Ç—É–ª–æ–≤–∏—â–∞). –ß—É–≤—Å—Ç–≤–æ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏, —Å–ª–∞–±–æ—Å—Ç—å.
–ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–µ –º—É—Å–∫—É–ª—ã (‚â•2 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—É—Ä–Ω—ã—Ö –ª–∏–Ω–∏–π ‚â•5 –º–º). –°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Å–∏–ª–µ, –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —Å–ª–∞–±–æ—Å—Ç–∏.

–†—É–∫–∏:
–°–∏–ª—å–Ω—ã–µ (–¥–ª–∏–Ω–∞ ‚â•30 % –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.8 –º–º, —É–≥–æ–ª ‚â•20¬∞). –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —ç–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å.
–°–ª–∞–±—ã–µ (‚â§20 % –≤—ã—Å–æ—Ç—ã, —Ç–æ–ª—â–∏–Ω–∞ <0.5 –º–º). –ü–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.
–°–ø—Ä—è—Ç–∞–Ω–Ω—ã–µ (–Ω–µ –≤–∏–¥–Ω—ã –∏–ª–∏ ‚â§5 –º–º). –ß—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã, –Ω–µ–ª–æ–≤–∫–æ—Å—Ç—å.
–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ —Å–µ–±—è (—Å–≥–∏–± ‚â•45¬∞, –∫–∏—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç—É—Ä–∞). –ê—É—Ç–æ–∞–≥—Ä–µ—Å—Å–∏—è.

–ù–æ–≥–∏:
–°–∏–ª—å–Ω—ã–µ (–¥–ª–∏–Ω–∞ ‚â•40 % –≤—ã—Å–æ—Ç—ã, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.8 –º–º). –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.
–°–ª–∞–±—ã–µ (—Ç–æ–ª—â–∏–Ω–∞ <0.5 –º–º, —à–∏—Ä–∏–Ω–∞ ‚â§10 %). –ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–ø–æ—Ä–µ.
–ö–æ—Ä–æ—Ç–∫–∏–µ (‚â§30 % –≤—ã—Å–æ—Ç—ã). –ò–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—è.

–û–¥–µ–∂–¥–∞:
–ü–æ–¥—Ä–æ–±–Ω–∞—è (‚â•3 —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —Ç–æ–ª—â–∏–Ω–∞ ‚â•0.6 –º–º, –¥–µ—Ç–∞–ª–∏ ‚â•30 % –ø–ª–æ—â–∞–¥–∏ —Ç—É–ª–æ–≤–∏—â–∞). –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ø—Ä–∏–∑–Ω–∞–Ω–∏–∏, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ.
–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è (1 –ª–∏–Ω–∏—è, –¥–ª–∏–Ω–∞ ‚â§50 % –ø–µ—Ä–∏–º–µ—Ç—Ä–∞, —Ç–æ–ª—â–∏–Ω–∞ <0.5 –º–º). –°–∫—Ä–æ–º–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç–∞.
–ù–µ–æ–ø—Ä—è—Ç–Ω–∞—è (‚â•3 —Ä–∞–∑—Ä—ã–≤–∞ –Ω–∞ 50 –º–º, –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å >30 %). –ü—Ä–µ–Ω–µ–±—Ä–µ–∂–µ–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º–∏ –Ω–æ—Ä–º–∞–º–∏.

–û—Ç–≤–µ—Ç –¥–ª—è —Ä–∏—Å—É–Ω–∫–∞ 1 –¥–∞–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

–†–∏—Å—É–Ω–æ–∫ 1 (–î–æ–º/–î–µ—Ä–µ–≤–æ/–ß–µ–ª–æ–≤–µ–∫).

1. –†–∞–∑–º–µ—Ä —Ä–∏—Å—É–Ω–∫–∞: –ú–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä
2. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ª–∏—Å—Ç–µ: –í —Ü–µ–Ω—Ç—Ä–µ
3. –°–∏–ª–∞ –Ω–∞–∂–∏–º–∞: –°–ª–∞–±—ã–π –Ω–∞–∂–∏–º
4. –•–∞—Ä–∞–∫—Ç–µ—Ä –ª–∏–Ω–∏–π: –ü—Ä–µ—Ä—ã–≤–∏—Å—Ç—ã–µ, –Ω–µ—Ä–æ–≤–Ω—ã–µ –ª–∏–Ω–∏–∏
5. –ö–æ–º–ø–æ–∑–∏—Ü–∏—è: –ì–∞—Ä–º–æ–Ω–∏—á–Ω–∞—è, —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è

–î–æ–º:

1. –§—É–Ω–¥–∞–º–µ–Ω—Ç: –ù–∞–ª–∏—á–∏–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞
2. –°—Ç–µ–Ω—ã: –ö—Ä–µ–ø–∫–∏–µ —Å—Ç–µ–Ω—ã
3. –ö—Ä—ã—à–∞: –ë–æ–ª—å—à–∞—è –∫—Ä—ã—à–∞
4. –î–≤–µ—Ä—å: –ó–∞–∫—Ä—ã—Ç–∞—è –¥–≤–µ—Ä—å
5. –û–∫–Ω–∞: –ë–æ–ª—å—à–∏–µ –æ–∫–Ω–∞
6. –¢—Ä—É–±–∞: –î–æ–º –±–µ–∑ —Ç—Ä—É–±—ã

–î–µ—Ä–µ–≤–æ:

1. –ö–æ—Ä–Ω–∏: –ù–∞–ª–∏—á–∏–µ –∫–æ—Ä–Ω–µ–π
2. –°—Ç–≤–æ–ª: –ò—Å–∫—Ä–∏–≤–ª–µ–Ω–Ω—ã–π —Å—Ç–≤–æ–ª
3. –í–µ—Ç–≤–∏: –ü–æ–¥–Ω—è—Ç—ã–µ –≤–≤–µ—Ä—Ö –≤–µ—Ç–≤–∏
4. –ö—Ä–æ–Ω–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—Ä–æ–Ω—ã
5. –ü–ª–æ–¥—ã, –ª–∏—Å—Ç—å—è: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–ª–æ–¥–æ–≤, –ª–∏—Å—Ç—å–µ–≤

–ß–µ–ª–æ–≤–µ–∫:

1. –û–¥–µ–∂–¥–∞: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–¥–µ–∂–¥–∞
2. –†—É–∫–∏: –°–ª–∞–±—ã–µ —Ä—É–∫–∏
3. –ù–æ–≥–∏: –°–ª–∞–±—ã–µ –Ω–æ–≥–∏
4. –ì–æ–ª–æ–≤–∞: –°—Ä–µ–¥–Ω—è—è –≥–æ–ª–æ–≤–∞
5. –ì–ª–∞–∑–∞: –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–µ –≥–ª–∞–∑–∞
6. –£—à–∏: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—à–µ–π
7. –¢–µ–ª–æ: –£–∑–∫–∏–µ –ø–ª–µ—á–∏

""".strip()

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ¬ª
PROMPT_ANIMAL = """
–ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π ‚Äî —Å–∫–∞–Ω –∏–ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —Ä–∏—Å—É–Ω–∫–∞ —Ç–µ–º—ã ¬´–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ñ–∏–≤–æ—Ç–Ω–æ–µ¬ª. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –≤ –¥–≤–∞ —ç—Ç–∞–ø–∞: —Å–Ω–∞—á–∞–ª–∞ –∏–∑–º–µ—Ä–∏—Ç—å –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ 
–≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–≠—Ç–∞–ø 1), –∑–∞—Ç–µ–º –æ—Ç–Ω–µ—Å—Ç–∏ –∫–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫ –æ–¥–Ω–æ–º—É –∏–∑ , –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ—á–µ—á–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏ –ø–æ—Ä–æ–≥–æ–≤—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã (–≠—Ç–∞–ø 2). –í –æ—Ç–≤–µ—Ç–µ —É–∫–∞–∂–∏ —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≠—Ç–∞–ø–∞ 2.

–≠—Ç–∞–ø 1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –∏–∑–º–µ—Ä—å –∏–ª–∏ –æ—Ü–µ–Ω–∏ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ:
‚Äî –†–∞–∑–º–µ—Ä –∂–∏–≤–æ—Ç–Ω–æ–≥–æ: –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∏—Å—Ç–∞ –ø–æ –≤—ã—Å–æ—Ç–µ (%)
‚Äî –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ª–∏—Å—Ç–µ: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ –º–∞—Å—Å —Ñ–∏–≥—É—Ä—ã –≤ % –æ—Ç —à–∏—Ä–∏–Ω—ã (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å) –∏ % –æ—Ç –≤—ã—Å–æ—Ç—ã (–≤–µ—Ä—Ç–∏–∫–∞–ª—å)
‚Äî –°–∏–ª–∞ –Ω–∞–∂–∏–º–∞: —Å—Ä–µ–¥–Ω—è—è —à–∏—Ä–∏–Ω–∞ —à—Ç—Ä–∏—Ö–∞ –∫–æ–Ω—Ç—É—Ä–æ–≤ (–º–º)
‚Äî –•–∞—Ä–∞–∫—Ç–µ—Ä –ª–∏–Ω–∏–π: –¥–ª–∏–Ω–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ (–º–º), —á–∏—Å–ª–æ —Ä–∞–∑—Ä—ã–≤–æ–≤ –Ω–∞ 20 –º–º, –Ω–∞–ª–∏—á–∏–µ –∑–∞—á—ë—Ä–∫–∏–≤–∞–Ω–∏–π –∏–ª–∏ —à—Ç—Ä–∏—Ö–æ–≤–∫–∏
‚Äî –û–±—â–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è: % —Ä–∏—Å—É–Ω–∫–∞ –≤ –∫–∞–∂–¥–æ–º –∏–∑ —á–µ—Ç—ã—Ä—ë—Ö –∫–≤–∞–¥—Ä–∞–Ω—Ç–æ–≤ –ª–∏—Å—Ç–∞, —Å–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –º–∞—Å—Å –æ—Ç –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞ (—Å–º–µ—â. %)
‚Äî –î–µ—Ç–∞–ª–∏ —Ñ–∏–≥—É—Ä—ã:
‚Ä¢ –í—ã—Å–æ—Ç–∞ –≥–æ–ª–æ–≤—ã –∫–∞–∫ % –æ—Ç –æ–±—â–µ–π –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã
‚Ä¢ –®–∏—Ä–∏–Ω–∞ –≥–æ–ª–æ–≤—ã –∫–∞–∫ % –æ—Ç —à–∏—Ä–∏–Ω—ã —Ç—É–ª–æ–≤–∏—â–∞
‚Ä¢ –†–∞–∑–º–µ—Ä –≥–ª–∞–∑: –¥–∏–∞–º–µ—Ç—Ä/—à–∏—Ä–∏–Ω–∞ –∫–∞–∫ % –æ—Ç —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã, –µ—Å—Ç—å / –Ω–µ—Ç –∑—Ä–∞—á–∫–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å–Ω–∏—Ü
‚Ä¢ –†–æ—Ç: –≤—ã—Å–æ—Ç–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∫–∞–∫ % –æ—Ç —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã, —Ñ–æ—Ä–º–∞ (–ª–∏–Ω–∏—è/–¥—É–≥–∞/–æ—Ç–∫—Ä—ã—Ç)
‚Ä¢ –£—à–∏: –Ω–∞–ª–∏—á–∏–µ (0/1/2), –≤—ã—Å–æ—Ç–∞ —É—Ö–∞ –∫–∞–∫ % –æ—Ç –≤—ã—Å–æ—Ç—ã –≥–æ–ª–æ–≤—ã
‚Ä¢ –†–æ–≥–∞/–∫—Ä—ã–ª—å—è/–ø–ª–∞–≤–Ω–∏–∫–∏/—à–∏–ø—ã: —á–∏—Å–ª–æ –∏–ª–∏ –¥–ª–∏–Ω–∞ —ç—Ç–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—à—Ç.)
‚Ä¢ –•–≤–æ—Å—Ç: –¥–ª–∏–Ω–∞ –∫–∞–∫ % –æ—Ç –æ–±—â–µ–π –¥–ª–∏–Ω—ã —Ç–µ–ª–∞, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑/–≤ —Å—Ç–æ—Ä–æ–Ω—É)
‚Äî –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –ø–æ–¥—Ä–∏—Å—É–Ω–æ—á–Ω–∞—è –Ω–∞–¥–ø–∏—Å—å: –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤), —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–∞ –±—É–∫–≤ (–ø—Ä—è–º–∞—è/–∑–∞–∫–æ—Ä—é—á–∫–∏)

–≠—Ç–∞–ø 2. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –±–∞–∑–æ–≤—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
–ò—Å–ø–æ–ª—å–∑—É—è –∏–∑–º–µ—Ä–µ–Ω–Ω—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –≤—ã–±–µ—Ä–∏ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –∫—Ä–∏—Ç–µ—Ä–∏–π, –ø—Ä–∏–≤–µ–¥–∏ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–∏—Ç–∞—Ç—É –æ–ø–∏—Å–∞–Ω–∏—è –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–∏—Ñ—Ä –∏–ª–∏ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:

–†–∞–∑–º–µ—Ä –∂–∏–≤–æ—Ç–Ω–æ–≥–æ:
- –ë–æ–ª—å—à–æ–π (–∑–∞–Ω–∏–º–∞–µ—Ç >65 % –≤—ã—Å–æ—Ç—ã –ª–∏—Å—Ç–∞). –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Å–∞–º–æ—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é, –≤—ã—Å–æ–∫—É—é —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É, —ç–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—é, –∏–Ω–æ–≥–¥–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é —á—É–≤—Å—Ç–≤–∞ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏.
- –°—Ä–µ–¥–Ω–∏–π (35‚Äì65 % –≤—ã—Å–æ—Ç—ã). –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, —É—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω–æ—Å—Ç—å, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å.
- –ú–∞–ª–µ–Ω—å–∫–∏–π (<35 % –≤—ã—Å–æ—Ç—ã). –ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞—Å—Ç–µ–Ω—á–∏–≤–æ—Å—Ç—å, –∏–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è, —á—É–≤—Å—Ç–≤–æ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏.

–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ª–∏—Å—Ç–µ:
- –í —Ü–µ–Ω—Ç—Ä–µ (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ 30‚Äì70 %). –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, —É—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω–æ—Å—Ç—å.
- –°–≤–µ—Ä—Ö—É (—Ü–µ–Ω—Ç –º–∞—Å—Å –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ ‚â•70 %). –§–∞–Ω—Ç–∞–∑–∏–∏, –∏–¥–µ–∞–ª–∏–∑–º, –æ—Ç–æ—Ä–≤–∞–Ω–Ω–æ—Å—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.
- –°–Ω–∏–∑—É (‚â§30 % –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏). –ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–ø–æ—Ä–µ.
- –°–ª–µ–≤–∞ (‚â§30 % –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏). –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ—à–ª–æ–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –º–∞—Ç–µ—Ä–∏.
- –°–ø—Ä–∞–≤–∞ (‚â•70 % –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏). –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –±—É–¥—É—â–µ–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –æ—Ç—Ü–∞.

–°–∏–ª–∞ –Ω–∞–∂–∏–º–∞:
- –°–∏–ª—å–Ω—ã–π (>1 –º–º). –≠–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å.
- –°–ª–∞–±—ã–π (<1 –º–º). –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –∞—Å—Ç–µ–Ω–∏—è.

–•–∞—Ä–∞–∫—Ç–µ—Ä –ª–∏–Ω–∏–π:
- –ß—ë—Ç–∫–∏–µ, —Ä–æ–≤–Ω—ã–µ (—Å–µ–≥–º–µ–Ω—Ç ‚â•15 –º–º, <3 —Ä–∞–∑—Ä—ã–≤–æ–≤ –Ω–∞ 20 –º–º). –ö–æ–Ω—Ç—Ä–æ–ª—å, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.
- –ü—Ä–µ—Ä—ã–≤–∏—Å—Ç—ã–µ, –Ω–µ—Ä–æ–≤–Ω—ã–µ (—Å–µ–≥–º–µ–Ω—Ç ‚â§10 –º–º, ‚â•5 —Ä–∞–∑—Ä—ã–≤–æ–≤ –Ω–∞ 20 –º–º). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å.
- –ó–∞—à—Ç—Ä–∏—Ö–æ–≤–∞–Ω–Ω—ã–µ (—à—Ç—Ä–∏—Ö–æ–≤–∫–∞ ‚â•5 –ª–∏–Ω–∏–π –Ω–∞ 10 –º–º). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–µ —ç–º–æ—Ü–∏–∏.

–û–±—â–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è:
- –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (–∫–∞–∂–¥—ã–π –∫–≤–∞–¥—Ä–∞–Ω—Ç 15‚Äì35 %, —Å–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ ‚â§10 %). –£—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω–æ—Å—Ç—å, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å.
- –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–∞—è (–æ–¥–∏–Ω –∫–≤–∞–¥—Ä–∞–Ω—Ç ‚â•50 %, —Å–º–µ—â–µ–Ω–∏–µ ‚â•20 %). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç.
- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è (—Ä–∏—Å—É–Ω–æ–∫ ‚â§30 % –ª–∏—Å—Ç–∞, ‚â•40 % –ø—É—Å—Ç–æ). –ò–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å.

–ì–æ–ª–æ–≤–∞:
- –ë–æ–ª—å—à–∞—è (–≤—ã—Å–æ—Ç–∞ >25 % —Ñ–∏–≥—É—Ä—ã). –†–∞–∑–≤–∏—Ç—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –∑–Ω–∞–Ω–∏—è–º.
- –ú–∞–ª–µ–Ω—å–∫–∞—è (<15 %). –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ø–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.

–ì–ª–∞–∑–∞:
- –ë–æ–ª—å—à–∏–µ, —à–∏—Ä–æ–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ (>15 % —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã). –ò–Ω—Ç–µ—Ä–µ—Å –∫ –º–∏—Ä—É, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏, –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ.
- –ú–∞–ª–µ–Ω—å–∫–∏–µ, —É–∑–∫–∏–µ (<10 %). –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å, —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å.
- –ë–µ–∑ –∑—Ä–∞—á–∫–æ–≤ (–∑—Ä–∞—á–∫–∏ –Ω–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω—ã). –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ç—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ—Å—Ç—å.
- –° –ø–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–º–∏ —Ä–µ—Å–Ω–∏—Ü–∞–º–∏ (‚â•3 —Ä–µ—Å–Ω–∏—Ü—ã –Ω–∞ –≥–ª–∞–∑). –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤–æ –≤–Ω–∏–º–∞–Ω–∏–∏.


–†–æ—Ç:
- –ë–æ–ª—å—à–æ–π, –æ—Ç–∫—Ä—ã—Ç—ã–π (–≤—ã—Å–æ—Ç–∞ >10 % –≤—ã—Å–æ—Ç—ã –≥–æ–ª–æ–≤—ã). –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ —ç–º–æ—Ü–∏–π.
- –° –∑—É–±–∞–º–∏ (–∑–∞–º–∫–Ω—É—Ç—ã–µ –∫–æ–Ω—Ç—É—Ä—ã —Å —Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏). –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å, –∑–∞—â–∏—Ç–∞, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏—é.
- –ú–∞–ª–µ–Ω—å–∫–∏–π, –∑–∞–∫—Ä—ã—Ç—ã–π (<10 % —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã). –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–π, –∑–∞—Å—Ç–µ–Ω—á–∏–≤–æ—Å—Ç—å.
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä—Ç–∞ (–Ω–µ—Ç –∫–æ–Ω—Ç—É—Ä–∞). –¢—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –æ–±—â–µ–Ω–∏–∏, –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π.

–£—à–∏:
- –ë–æ–ª—å—à–∏–µ (>15 % –≤—ã—Å–æ—Ç—ã –≥–æ–ª–æ–≤—ã). –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤–æ –≤–Ω–∏–º–∞–Ω–∏–∏, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –∫—Ä–∏—Ç–∏–∫–µ.
- –ú–∞–ª–µ–Ω—å–∫–∏–µ (<10 %). –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—à–µ–π. –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∑–∞–º–∫–Ω—É—Ç–æ—Å—Ç—å.

–†–æ–≥–∞/–∫–æ–≥—Ç–∏/–∑—É–±—ã/—à–∏–ø—ã:
- –ú–Ω–æ–≥–æ (>3 —ç–ª–µ–º–µ–Ω—Ç–æ–≤). –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∞–≥—Ä–µ—Å—Å–∏–∏, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –∑–∞—â–∏—Ç–µ.
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç (0 —ç–ª–µ–º–µ–Ω—Ç–æ–≤). –ë–µ–∑–∑–∞—â–∏—Ç–Ω–æ—Å—Ç—å, —Å–ª–∞–±–æ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≥—Ä–µ—Å—Å–∏–∏.

–ö—Ä—ã–ª—å—è/–ø–ª–∞–≤–Ω–∏–∫–∏/–ø–µ—Ä–µ–ø–æ–Ω–∫–∏:
- –ï—Å—Ç—å –∫—Ä—ã–ª—å—è. –°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Å–≤–æ–±–æ–¥–µ, —Ñ–∞–Ω—Ç–∞–∑–∏—è–º, —É—Ö–æ–¥ –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.
- –ï—Å—Ç—å –ø–ª–∞–≤–Ω–∏–∫–∏. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø—Ä–∏—Å–ø–æ—Å–æ–±–ª—è–µ–º–æ—Å—Ç—å.

–•–≤–æ—Å—Ç(–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞):
- –î–ª–∏–Ω–Ω—ã–π (>30 % –¥–ª–∏–Ω—ã —Ç–µ–ª–∞). –í–ª–∏—è–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å.
- –ö–æ—Ä–æ—Ç–∫–∏–π (<15 %). –ò–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—è.
- –ü–æ–¥–Ω—è—Ç—ã–π –≤–≤–µ—Ä—Ö. –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –æ–ø—Ç–∏–º–∏–∑–º.
- –û–ø—É—â–µ–Ω–Ω—ã–π –≤–Ω–∏–∑. –ü–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å, –ø–µ—Å—Å–∏–º–∏–∑–º.

–ù–∞–∑–≤–∞–Ω–∏–µ:
- –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ (1‚Äì2 —Å–ª–æ–≤–∞). –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å.
- –°–ª–æ–∂–Ω–æ–µ, –Ω–µ–æ–±—ã—á–Ω–æ–µ (>2 —Å–ª–æ–≤ –∏–ª–∏ –Ω–µ–æ–ª–æ–≥–∏–∑–º). –§–∞–Ω—Ç–∞–∑–∏—è, –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å.
- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ (—É–≥—Ä–æ–∂–∞—é—â–µ–µ –ª–µ–∫—Å–µ–º–∞). –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏.
- –°–º–µ—à–Ω–æ–µ, –Ω–µ–ª–µ–ø–æ–µ (–∫–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç). –Æ–º–æ—Ä, —Å–∞–º–æ–∏—Ä–æ–Ω–∏—è.

–û–ø–∏—Å–∞–Ω–∏–µ:
- –û–ø–∏—Å–∞–Ω–∏–µ —Å–∏–ª—å–Ω–æ–≥–æ, —Å–º–µ–ª–æ–≥–æ. –°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Å–∏–ª–µ, –≤—ã—Å–æ–∫–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞.
- –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∞–±–æ–≥–æ, –±–µ–∑–∑–∞—â–∏—Ç–Ω–æ–≥–æ. –ù–∏–∑–∫–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –∑–∞—â–∏—Ç–µ.
- –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–±—Ä–æ–≥–æ, –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–≥–æ. –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ª—é–±–≤–∏ –∏ –ø—Ä–∏–Ω—è—Ç–∏–∏.
- –û–ø–∏—Å–∞–Ω–∏–µ –∑–ª–æ–≥–æ, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ. –ü–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–µ —ç–º–æ—Ü–∏–∏, –∞–≥—Ä–µ—Å—Å–∏—è.

–°—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è –∏ –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏:
- –¢—ë–º–Ω–æ–µ –º–µ—Å—Ç–æ. –°—Ç—Ä–∞—Ö–∏ —Ç–µ–º–Ω–æ—Ç—ã, –Ω–µ–∏–∑–≤–µ–¥–∞–Ω–Ω–æ–≥–æ.
- –í–æ–¥–∞/—Ä–µ–∫–∞. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å.
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏. –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏–ª–∏ –∑–∞–º–∫–Ω—É—Ç–æ—Å—Ç—å (–ø–æ —á–∏—Å–ª—É —Å–æ—Å–µ–¥–Ω–∏—Ö —Ñ–∏–≥—É—Ä).

–û—Ç–≤–µ—Ç –¥–ª—è —Ä–∏—Å—É–Ω–∫–∞ 2 –¥–∞–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
–†–∏—Å—É–Ω–æ–∫ 2 (–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ).

1. –†–∞–∑–º–µ—Ä –∂–∏–≤–æ—Ç–Ω–æ–≥–æ: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
2. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ª–∏—Å—Ç–µ: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
3. –°–∏–ª–∞ –Ω–∞–∂–∏–º–∞: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
4. –•–∞—Ä–∞–∫—Ç–µ—Ä –ª–∏–Ω–∏–π: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
5. –ö–æ–º–ø–æ–∑–∏—Ü–∏—è: <–∫—Ä–∏—Ç–µ—Ä–∏–π>

–î–µ—Ç–∞–ª–∏ —Ñ–∏–≥—É—Ä—ã:
1. –ì–æ–ª–æ–≤–∞: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
2. –ì–ª–∞–∑–∞: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
3. –†–æ—Ç: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
4. –£—à–∏: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
5. –†–æ–≥–∞/–∫–æ–≥—Ç–∏/–∑—É–±—ã/—à–∏–ø—ã: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
6. –ö—Ä—ã–ª—å—è/–ø–ª–∞–≤–Ω–∏–∫–∏/–ø–µ—Ä–µ–ø–æ–Ω–∫–∏: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
7. –•–≤–æ—Å—Ç: <–∫—Ä–∏—Ç–µ—Ä–∏–π>

–ù–∞–∑–≤–∞–Ω–∏–µ:
1. –ù–∞–∑–≤–∞–Ω–∏–µ: <–∫—Ä–∏—Ç–µ—Ä–∏–π>

–û–ø–∏—Å–∞–Ω–∏–µ:
1. –û–ø–∏—Å–∞–Ω–∏–µ: <–∫—Ä–∏—Ç–µ—Ä–∏–π>

–°—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è –∏ –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏:
1. –°—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è –∏ –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
    """.strip()

    # –ü—Ä–æ–º–ø—Ç –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´–ê–≤—Ç–æ–ø–æ—Ä—Ç—Ä–µ—Ç¬ª
PROMPT_SELF_PORTRAIT = """
–ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π ‚Äî —Å–∫–∞–Ω –∏–ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —Ä–∏—Å—É–Ω–∫–∞ –Ω–∞ —Ç–µ–º—É ¬´–ê–≤—Ç–æ–ø–æ—Ä—Ç—Ä–µ—Ç¬ª. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –≤ –¥–≤–∞ —ç—Ç–∞–ø–∞: —Å–Ω–∞—á–∞–ª–∞ –∏–∑–º–µ—Ä–∏—Ç—å –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å
–∫–ª—é—á–µ–≤—ã–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∑–∞—Ç–µ–º –æ—Ç–Ω–µ—Å—Ç–∏ –∫–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫ –æ–¥–Ω–æ–º—É –∏–∑ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤. 
–í –æ—Ç–≤–µ—Ç–µ —É–∫–∞–∂–∏ —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≠—Ç–∞–ø–∞ 2.
–û—Ç–≤–µ—Ç –¥–∞–π –±–µ–∑ –º–∞—Ä–∫–¥–∞—É–Ω —Ä–∞–∑–º–µ—Ç–∫–∏, –Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º "\n" —Ä–∞–∑–º–µ—Ç–∫–∏


–≠—Ç–∞–ø 1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –∏–∑–º–µ—Ä—å –∏–ª–∏ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ –æ—Ü–µ–Ω–∏ –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö –∏–ª–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç –ª–∏—Å—Ç–∞/—Ñ–∏–≥—É—Ä—ã:
‚Äî –†–∞–∑–º–µ—Ä —Ñ–∏–≥—É—Ä—ã: –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∏—Å—Ç–∞ –ø–æ –≤—ã—Å–æ—Ç–µ.
‚Äî –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ª–∏—Å—Ç–µ: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ –º–∞—Å—Å —Ñ–∏–≥—É—Ä—ã –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∏ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏.
‚Äî –°–∏–ª–∞ –Ω–∞–∂–∏–º–∞: —Å—Ä–µ–¥–Ω—è—è —à–∏—Ä–∏–Ω–∞ —à—Ç—Ä–∏—Ö–∞ –∫–æ–Ω—Ç—É—Ä–∞ (–º–º).
‚Äî –•–∞—Ä–∞–∫—Ç–µ—Ä –ª–∏–Ω–∏–π: —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ (–º–º), —á–∏—Å–ª–æ —Ä–∞–∑—Ä—ã–≤–æ–≤ –Ω–∞ 20 –º–º, –Ω–∞–ª–∏—á–∏–µ —à—Ç—Ä–∏—Ö–æ–≤–∫–∏.
‚Äî –û–±—â–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è: –¥–æ–ª—è —Ä–∏—Å—É–Ω–∫–∞ –≤ –∫–∞–∂–¥–æ–º –∏–∑ 4 –∫–≤–∞–¥—Ä–∞–Ω—Ç–æ–≤ –ª–∏—Å—Ç–∞ (%).
II. –ê–Ω–∞–ª–∏–∑ –¥–µ—Ç–∞–ª–µ–π —Ñ–∏–≥—É—Ä—ã:
‚Äî –ì–æ–ª–æ–≤–∞: –≤—ã—Å–æ—Ç–∞ –≥–æ–ª–æ–≤—ã –∫–∞–∫ % –æ—Ç –æ–±—â–µ–π –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã.
‚Äî –ì–ª–∞–∑–∞: —à–∏—Ä–∏–Ω–∞ –≥–ª–∞–∑–∞ –∫–∞–∫ % –æ—Ç —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã, –Ω–∞–ª–∏—á–∏–µ –∑—Ä–∞—á–∫–æ–≤, —á–∏—Å–ª–æ —Ä–µ—Å–Ω–∏—Ü.
‚Äî –†–æ—Ç: —à–∏—Ä–∏–Ω–∞ —Ä—Ç–∞ –∫–∞–∫ % –æ—Ç —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã, —Ñ–æ—Ä–º–∞ (–ª–∏–Ω–∏—è/–¥—É–≥–∞).
‚Äî –£—à–∏: –Ω–∞–ª–∏—á–∏–µ —É—à–µ–π (0, 1 –∏–ª–∏ 2), –≤—ã—Å–æ—Ç–∞ —É—Ö–∞ –∫–∞–∫ % –æ—Ç –≤—ã—Å–æ—Ç—ã –≥–æ–ª–æ–≤—ã.
‚Äî –ü–ª–µ—á–∏: —à–∏—Ä–∏–Ω–∞ –ø–ª–µ—á –∫–∞–∫ % –æ—Ç —à–∏—Ä–∏–Ω—ã —Ç—É–ª–æ–≤–∏—â–∞.
‚Äî –®–µ—è: –¥–ª–∏–Ω–∞ —à–µ–∏ (–º–º) –∏ —Ç–æ–ª—â–∏–Ω–∞ —à–µ–∏ (–º–º).
‚Äî –¢–∞–ª–∏—è: —à–∏—Ä–∏–Ω–∞ —Ç–∞–ª–∏–∏ –∫–∞–∫ % –æ—Ç —à–∏—Ä–∏–Ω—ã –≥—Ä—É–¥–∏.
‚Äî –†—É–∫–∏: –¥–ª–∏–Ω–∞ —Ä—É–∫ –∫–∞–∫ % –æ—Ç –æ–±—â–µ–π –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã.
‚Äî –ù–æ–≥–∏: –¥–ª–∏–Ω–∞ –Ω–æ–≥ –∫–∞–∫ % –æ—Ç –æ–±—â–µ–π –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã.
‚Äî –û–¥–µ–∂–¥–∞: –¥–æ–ª—è –ø–ª–æ—â–∞–¥–∏ –æ–¥–µ–∂–¥—ã, –∑–∞–Ω—è—Ç–∞—è –¥–µ—Ç–∞–ª—è–º–∏ (—É–∑–æ—Ä—ã) –≤ %.

–≠—Ç–∞–ø 2. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –±–∞–∑–æ–≤—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
–ò—Å–ø–æ–ª—å–∑—É—è –∏–∑–º–µ—Ä–µ–Ω–Ω—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –≤—ã–±–µ—Ä–∏ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –∫—Ä–∏—Ç–µ—Ä–∏–π –∏–∑ –±–∞–∑–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞, —É–∫–∞–∂–∏ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, –Ω–∞ —á—Ç–æ –æ–Ω –º–æ–∂–µ—Ç 
—É–∫–∞–∑—ã–≤–∞—Ç—å, –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–∏—Ñ—Ä.

–†–∞–∑–º–µ—Ä —Ñ–∏–≥—É—Ä—ã:
- –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä (—Ä–∏—Å—É–Ω–æ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç >65 % –≤—ã—Å–æ—Ç—ã –ª–∏—Å—Ç–∞). –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –≤—ã—Å–æ–∫—É—é —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤–æ –≤–Ω–∏–º–∞–Ω–∏–∏. –ò–Ω–æ–≥–¥–∞ ‚Äì –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∞ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏.
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä (—Ä–∏—Å—É–Ω–æ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç 35‚Äì65 % –≤—ã—Å–æ—Ç—ã –ª–∏—Å—Ç–∞). –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å, –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞.
- –ú–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä (—Ä–∏—Å—É–Ω–æ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç <35 % –≤—ã—Å–æ—Ç—ã –ª–∏—Å—Ç–∞). –ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞—Å—Ç–µ–Ω—á–∏–≤–æ—Å—Ç—å, –Ω–∏–∑–∫–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞, —á—É–≤—Å—Ç–≤–æ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏.

–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ª–∏—Å—Ç–µ:
- –í —Ü–µ–Ω—Ç—Ä–µ (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ 30‚Äì70 %). –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ø—Ä–∏–∑–Ω–∞–Ω–∏–∏, –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞.
- –°–≤–µ—Ä—Ö—É (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ ‚â•70 %). –ò–¥–µ–∞–ª–∏–∑–º, –≤—ã—Å–æ–∫–∏–µ –∞–º–±–∏—Ü–∏–∏, –æ—Ç–æ—Ä–≤–∞–Ω–Ω–æ—Å—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏. –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∑–∞–≤—ã—à–µ–Ω–Ω—É—é —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É.
- –°–Ω–∏–∑—É (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ ‚â§30 %). –ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–ø–æ—Ä–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö. –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∑–∞–Ω–∏–∂–µ–Ω–Ω—É—é —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É.
- –°–ª–µ–≤–∞ (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ ‚â§30 %). –ò–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è, –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ—à–ª–æ–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –º–∞—Ç–µ—Ä–∏. –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é –∏ —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑.
- –°–ø—Ä–∞–≤–∞ (—Ü–µ–Ω—Ç—Ä –º–∞—Å—Å –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ ‚â•70 %). –≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è, –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –±—É–¥—É—â–µ–µ, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏. –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –Ω–æ–≤—ã–º –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º –∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º.

–°–∏–ª–∞ –Ω–∞–∂–∏–º–∞:
- –°–∏–ª—å–Ω—ã–π (—à–∏—Ä–∏–Ω–∞ —à—Ç—Ä–∏—Ö–∞ >1 –º–º). –≠–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.
- –°–ª–∞–±—ã–π (—à–∏—Ä–∏–Ω–∞ —à—Ç—Ä–∏—Ö–∞ <1 –º–º). –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –∞—Å—Ç–µ–Ω–∏—è, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.

–•–∞—Ä–∞–∫—Ç–µ—Ä –ª–∏–Ω–∏–π:
- –ß—ë—Ç–∫–∏–µ, —Ä–æ–≤–Ω—ã–µ (–¥–ª–∏–Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∞ ‚â•15 –º–º, <3 —Ä–∞–∑—Ä—ã–≤–æ–≤ –Ω–∞ 20 –º–º, –≤–∞—Ä–∏–∞—Ü–∏—è —Ç–æ–ª—â–∏–Ω—ã <20 %). –ö–æ–Ω—Ç—Ä–æ–ª—å, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.
- –ü—Ä–µ—Ä—ã–≤–∏—Å—Ç—ã–µ, –Ω–µ—Ä–æ–≤–Ω—ã–µ (–¥–ª–∏–Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∞ ‚â§10 –º–º, ‚â•5 —Ä–∞–∑—Ä—ã–≤–æ–≤ –Ω–∞ 20 –º–º, ‚â•5 —Ä–µ–∑–∫–∏—Ö –∏–∑–ª–æ–º–æ–≤ >30¬∞ –Ω–∞ 20 –º–º). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å.
- –ó–∞—à—Ç—Ä–∏—Ö–æ–≤–∞–Ω–Ω—ã–µ (–ø–ª–æ—Ç–Ω–æ—Å—Ç—å —à—Ç—Ä–∏—Ö–æ–≤–∫–∏ ‚â•5 –ª–∏–Ω–∏–π –Ω–∞ 10 –º–º, —à—Ç—Ä–∏—Ö–æ–≤–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç ‚â•20 % –¥–ª–∏–Ω—ã –∫–æ–Ω—Ç—É—Ä–∞). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–µ —ç–º–æ—Ü–∏–∏, –æ—â—É—â–µ–Ω–∏–µ –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç–∞.

–û–±—â–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è:
- –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (–∫–∞–∂–¥—ã–π –∫–≤–∞–¥—Ä–∞–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç 15‚Äì35 % —Ä–∏—Å—É–Ω–∫–∞, —Ü–µ–Ω—Ç—Ä –º–∞—Å—Å —Å–º–µ—â—ë–Ω ‚â§10 %). –ì–∞—Ä–º–æ–Ω–∏—á–Ω–æ–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ —Å–µ–±—è, —É—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω–æ—Å—Ç—å.
- –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–∞—è (–æ–¥–∏–Ω –∫–≤–∞–¥—Ä–∞–Ω—Ç ‚â•50 %, —Ü–µ–Ω—Ç—Ä –º–∞—Å—Å —Å–º–µ—â—ë–Ω ‚â•20 %, ‚â•6 —Ç–æ—á–µ–∫ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –Ω–∞ 50 –º–º¬≤). –¢—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç, –ø–µ—Ä–µ–∏–∑–±—ã—Ç–æ–∫ —ç–º–æ—Ü–∏–π.
- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è (—Ä–∏—Å—É–Ω–æ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç ‚â§30 % –ø–ª–æ—â–∞–¥–∏ –ª–∏—Å—Ç–∞, ‚â•40 % –ª–∏—Å—Ç–∞ –ø—É—Å—Ç–æ, –æ–±—ä–µ–∫—Ç–æ–≤ ‚â§3). –ò–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–æ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —ç–Ω–µ—Ä–≥–∏–∏.

–ì–æ–ª–æ–≤–∞:
- –ë–æ–ª—å—à–∞—è –≥–æ–ª–æ–≤–∞ (–≤—ã—Å–æ—Ç–∞ –≥–æ–ª–æ–≤—ã >25 % –æ—Ç –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã). –í—ã—Å–æ–∫–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞ –≤ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ñ–µ—Ä–µ, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –∑–Ω–∞–Ω–∏—è–º, —Ä–∞–∑–≤–∏—Ç–æ–µ —Å–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏–µ. –ú–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∞–º–±–∏—Ü–∏–∏.
- –ú–∞–ª–µ–Ω—å–∫–∞—è –≥–æ–ª–æ–≤–∞ (–≤—ã—Å–æ—Ç–∞ –≥–æ–ª–æ–≤—ã <15 % –æ—Ç –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã). –ù–∏–∑–∫–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞ –≤ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ñ–µ—Ä–µ, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ø–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–≤–æ–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è—Ö.

–ì–ª–∞–∑–∞:
- –ë–æ–ª—å—à–∏–µ, —à–∏—Ä–æ–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ (—à–∏—Ä–∏–Ω–∞ –≥–ª–∞–∑–∞ >15 % —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã). –ò–Ω—Ç–µ—Ä–µ—Å –∫ –æ–∫—Ä—É–∂–∞—é—â–µ–º—É –º–∏—Ä—É, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏, –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å, –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ.
- –ú–∞–ª–µ–Ω—å–∫–∏–µ, —É–∑–∫–∏–µ (—à–∏—Ä–∏–Ω–∞ –≥–ª–∞–∑–∞ <10 % —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã). –°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å, –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ –æ–∫—Ä—É–∂–∞—é—â–µ–º—É –º–∏—Ä—É.
- –ì–ª–∞–∑–∞ –±–µ–∑ –∑—Ä–∞—á–∫–æ–≤ (–∑—Ä–∞—á–∫–∏ –Ω–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω—ã). –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ç—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ—Å—Ç—å, –∏–∑–±–µ–≥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞.
- –ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–µ —Ä–µ—Å–Ω–∏—Ü—ã (—Ä–µ—Å–Ω–∏—Ü ‚â•3 –Ω–∞ –≥–ª–∞–∑). –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤–æ –≤–Ω–∏–º–∞–Ω–∏–∏, –∫–æ–∫–µ—Ç—Å—Ç–≤–æ.

–†–æ—Ç:
- –£–ª—ã–±–∫–∞ (–¥—É–≥–æ–æ–±—Ä–∞–∑–Ω—ã–π –∫–æ–Ω—Ç—É—Ä, —É–≥–æ–ª–∫–∏ —Ä—Ç–∞ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π –ª–∏–Ω–∏–∏). –ü–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ —Å–µ–±–µ, —Ö–æ—Ä–æ—à–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –¥—Ä—É–∂–µ–ª—é–±–∏–µ.
- –ü—Ä—è–º–∞—è –ª–∏–Ω–∏—è (–∫–æ–Ω—Ç—É—Ä —Ä–æ–≤–Ω—ã–π –±–µ–∑ –¥—É–≥–∏). –ö–æ–Ω—Ç—Ä–æ–ª—å, —Å–¥–µ—Ä–∂–∞–Ω–Ω–æ—Å—Ç—å, –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–π.
- –û–ø—É—â–µ–Ω–Ω—ã–µ —É–≥–æ–ª–∫–∏ —Ä—Ç–∞ (—É–≥–æ–ª–∫–∏ –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–π –ª–∏–Ω–∏–∏). –ü–µ—Å—Å–∏–º–∏–∑–º, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å, –≥—Ä—É—Å—Ç—å.
- –ë–æ–ª—å—à–æ–π, –æ—Ç–∫—Ä—ã—Ç—ã–π —Ä–æ—Ç (–≤—ã—Å–æ—Ç–∞ —Ä—Ç–∞ >10 % –≤—ã—Å–æ—Ç—ã –≥–æ–ª–æ–≤—ã, –æ—Ç–¥–µ–ª—å–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏). –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ —ç–º–æ—Ü–∏–π (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–≥–æ–≤–æ—Ä—á–∏–≤–æ—Å—Ç—å).

–£—à–∏:
- –ë–æ–ª—å—à–∏–µ —É—à–∏ (–≤—ã—Å–æ—Ç–∞ —É—Ö–∞ >15 % –≤—ã—Å–æ—Ç—ã –≥–æ–ª–æ–≤—ã). –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤–æ –≤–Ω–∏–º–∞–Ω–∏–∏, –ø–æ–≤—ã—à–µ–Ω–Ω–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –∫—Ä–∏—Ç–∏–∫–µ.
- –ú–∞–ª–µ–Ω—å–∫–∏–µ —É—à–∏ (–≤—ã—Å–æ—Ç–∞ —É—Ö–∞ <10 % –≤—ã—Å–æ—Ç—ã –≥–æ–ª–æ–≤—ã). –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—à–µ–π (—É—à–∏ –Ω–µ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω—ã). –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∑–∞–º–∫–Ω—É—Ç–æ—Å—Ç—å.

–ü–ª–µ—á–∏:
- –®–∏—Ä–æ–∫–∏–µ –ø–ª–µ—á–∏ (—à–∏—Ä–∏–Ω–∞ –ø–ª–µ—á ‚â•100 % —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã). (–î–ª—è –º–∞–ª—å—á–∏–∫–æ–≤) –°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Å–∏–ª–µ, –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏—é, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ.
- –£–∑–∫–∏–µ –ø–ª–µ—á–∏ (—à–∏—Ä–∏–Ω–∞ –ø–ª–µ—á <80 % —à–∏—Ä–∏–Ω—ã –≥–æ–ª–æ–≤—ã). –ß—É–≤—Å—Ç–≤–æ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏, —Å–ª–∞–±–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.

–®–µ—è:
- –¢–æ–Ω–∫–∞—è —à–µ—è (—Ç–æ–ª—â–∏–Ω–∞ —à–µ–∏ <5 % —à–∏—Ä–∏–Ω—ã —Ç—É–ª–æ–≤–∏—â–∞). –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —É—è–∑–≤–∏–º–æ—Å—Ç—å, —Ö—Ä—É–ø–∫–æ—Å—Ç—å.
- –ö–æ—Ä–æ—Ç–∫–∞—è —à–µ—è (–¥–ª–∏–Ω–∞ —à–µ–∏ <5 % –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã). –£–ø—Ä—è–º—Å—Ç–≤–æ, —Ä–∏–≥–∏–¥–Ω–æ—Å—Ç—å, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –≥–∏–±–∫–æ—Å—Ç–∏.

–¢–∞–ª–∏—è:
- –ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç–∞—è —Ç–∞–ª–∏—è (—à–∏—Ä–∏–Ω–∞ —Ç–∞–ª–∏–∏ <80 % —à–∏—Ä–∏–Ω—ã –ø–ª–µ—á). (–î–ª—è –¥–µ–≤–æ—á–µ–∫) –ò–Ω—Ç–µ—Ä–µ—Å –∫  —Å–≤–æ–µ–π –≤–Ω–µ—à–Ω–æ—Å—Ç–∏, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

–†—É–∫–∏:
- –î–ª–∏–Ω–Ω—ã–µ, —Å–∏–ª—å–Ω—ã–µ —Ä—É–∫–∏ (–¥–ª–∏–Ω–∞ —Ä—É–∫ >40 % –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã). –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–∞—Ç—å —Ü–µ–ª–µ–π.
- –ö–æ—Ä–æ—Ç–∫–∏–µ, —Å–ª–∞–±—ã–µ —Ä—É–∫–∏ (–¥–ª–∏–Ω–∞ —Ä—É–∫ <20 % –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã). –ü–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–≤–æ–∏—Ö —Å–∏–ª–∞—Ö.
- –°–ø—Ä—è—Ç–∞–Ω–Ω—ã–µ –∑–∞ —Å–ø–∏–Ω–æ–π —Ä—É–∫–∏ (—Ä—É–∫–∏ –Ω–µ –≤–∏–¥–Ω—ã —Å–ø–µ—Ä–µ–¥–∏). –ß—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã, —Å—Ç–µ—Å–Ω–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–µ–∂–µ–ª–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å.
- –†—É–∫–∏, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ —Å–µ–±—è (—Ä—É–∫–∏ —Å–æ–≥–Ω—É—Ç—ã –∫ —Ç—É–ª–æ–≤–∏—â—É). –ê—É—Ç–æ–∞–≥—Ä–µ—Å—Å–∏—è, —Å–∞–º–æ–∫—Ä–∏—Ç–∏–∫–∞.

–ù–æ–≥–∏:
- –î–ª–∏–Ω–Ω—ã–µ, —Å–∏–ª—å–Ω—ã–µ –Ω–æ–≥–∏ (–¥–ª–∏–Ω–∞ –Ω–æ–≥ >50 % –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã). –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∞–∫—Ç–∏–≤–Ω–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è.
- –ö–æ—Ä–æ—Ç–∫–∏–µ, —Å–ª–∞–±—ã–µ –Ω–æ–≥–∏ (–¥–ª–∏–Ω–∞ –Ω–æ–≥ <35 % –≤—ã—Å–æ—Ç—ã —Ñ–∏–≥—É—Ä—ã). –ù–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –æ–ø–æ—Ä–µ.

–û–¥–µ–∂–¥–∞:
- –ü–æ–¥—Ä–æ–±–Ω–∞—è, —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ä–∏—Å–æ–≤–∞–Ω–Ω–∞—è –æ–¥–µ–∂–¥–∞ (—É–∑–æ—Ä–æ–≤ ‚â•5 –Ω–∞ 10 —Å–º¬≤). –°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤–æ –≤–Ω–∏–º–∞–Ω–∏–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º –Ω–æ—Ä–º–∞–º.
- –°—Ö–µ–º–∞—Ç–∏—á–Ω–∞—è –æ–¥–µ–∂–¥–∞ (—É–∑–æ—Ä–æ–≤ –Ω–µ—Ç). –°–∫—Ä–æ–º–Ω–æ—Å—Ç—å, –Ω–µ–∂–µ–ª–∞–Ω–∏–µ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ, –±–µ–∑—Ä–∞–∑–ª–∏—á–∏–µ –∫ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º –Ω–æ—Ä–º–∞–º.
- –ù–µ–æ–ø—Ä—è—Ç–Ω–∞—è –æ–¥–µ–∂–¥–∞ (–ª–∏–Ω–∏–∏ –Ω–µ—Ä–æ–≤–Ω—ã–µ, ¬´—Ä–≤–∞–Ω—ã–µ¬ª). –ü—Ä–µ–Ω–µ–±—Ä–µ–∂–µ–Ω–∏–µ –∫ —Å–µ–±–µ, –Ω–∏–∑–∫–∞—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞, –±—É–Ω—Ç–∞—Ä—Å—Ç–≤–æ.

–û—Ç–≤–µ—Ç –¥–ª—è —Ä–∏—Å—É–Ω–∫–∞ 3 –¥–∞—ë—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
–†–∏—Å—É–Ω–æ–∫ 3 (–ê–≤—Ç–æ–ø–æ—Ä—Ç—Ä–µ—Ç).
1. –†–∞–∑–º–µ—Ä —Ñ–∏–≥—É—Ä—ã: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
2. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ª–∏—Å—Ç–µ: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
3. –°–∏–ª–∞ –Ω–∞–∂–∏–º–∞: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
4. –•–∞—Ä–∞–∫—Ç–µ—Ä –ª–∏–Ω–∏–π: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
5. –û–±—â–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è: <–∫—Ä–∏—Ç–µ—Ä–∏–π>

–î–µ—Ç–∞–ª–∏ —Ñ–∏–≥—É—Ä—ã:
1. –ì–æ–ª–æ–≤–∞: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
2. –ì–ª–∞–∑–∞: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
3. –†–æ—Ç: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
4. –£—à–∏: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
5. –ü–ª–µ—á–∏: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
6. –®–µ—è: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
7. –¢–∞–ª–∏—è: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
8. –†—É–∫–∏: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
9. –ù–æ–≥–∏: <–∫—Ä–∏—Ç–µ—Ä–∏–π>
10. –û–¥–µ–∂–¥–∞: <–∫—Ä–∏—Ç–µ—Ä–∏–π>

""".strip()


def save_task(task_id: str, task_obj: dict) -> None:
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å –æ –∑–∞–¥–∞—á–µ.
    ‚Ä¢ –ù–æ–≤–æ–º—É –∫–ª—é—á—É ‚Üí TTL = TASK_TTL_SECONDS.
    ‚Ä¢ –°—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∫–ª—é—á—É ‚Üí –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–Ω—è–µ–º, TTL –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–µ–∂–Ω—é—é.
    """
    serialized = json.dumps(task_obj, separators=(",", ":"))

    try:
        # 1Ô∏è‚É£ –ø–æ–ø—ã—Ç–∫–∞: –æ–±–Ω–æ–≤–∏—Ç—å –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (XX) –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å TTL
        updated = redis_client.set(
            task_id,
            serialized,
            keepttl=True,   # –Ω–µ —Ç—Ä–æ–≥–∞–µ–º TTL
            xx=True         # —Å–¥–µ–ª–∞—Ç—å, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª—é—á –µ—Å—Ç—å
        )

        if not updated:
            # 2Ô∏è‚É£ –∫–ª—é—á–∞ –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞—ë–º —Å –Ω–æ–≤–æ–π TTL
            redis_client.set(
                task_id,
                serialized,
                ex=TASK_TTL_SECONDS,  # –∑–∞–¥–∞—Ç—å TTL
                nx=True               # —Å–¥–µ–ª–∞—Ç—å, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç
            )

    # ‚îÄ‚îÄ‚îÄ fallbacks ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    except (DataError, ResponseError):
        # –ö–ª–∏–µ–Ω—Ç –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç KEEPTTL / XX / NX ‚ûú –ø–∏—à–µ–º —Å –Ω–æ–≤–æ–π TTL
        redis_client.set(task_id, serialized, ex=TASK_TTL_SECONDS)

    except OutOfMemoryError as e:
        # Redis –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 503 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        raise HTTPException(
            status_code=503,
            detail=f"Redis –∏—Å—á–µ—Ä–ø–∞–ª –ø–∞–º—è—Ç—å: {e}"
        )

def load_task(task_id: str) -> dict:
    """–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É –ø–æ ID –∏–ª–∏ 404, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç."""
    raw = redis_client.get(task_id)
    if raw is None:
        raise HTTPException(status_code=404, detail="Task not found")
    return json.loads(raw)





async def request_openai(system: str, user: str, model: str = 'gpt-4.1-mini-2025-04-14', temp: Optional[float] = None):
    client = AsyncOpenAI()
    messages = [{'role': 'system', 'content': system}, {'role': 'user', 'content': user}]
    try:
        response = await client.chat.completions.create(model=model, messages=messages, temperature=temp)
        return response.choices[0].message.content
    except Exception as e:
        raise HTTPException(status_code=500, detail=f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –≤ OpenAI: {e}')

async def process_image(task_id: str, key: str, mime: str, b64: str, prompt: str):
    client = AsyncOpenAI()
    content = [
        {"type": "text", "text": prompt},
        {"type": "image_url", "image_url": {"url": f"data:{mime};base64,{b64}"}}
    ]
    try:
        resp = await client.chat.completions.create(
            model="gpt-4.1-mini-2025-04-14",
            messages=[{"role": "user", "content": content}]
        )
        result = resp.choices[0].message.content

        task = load_task(task_id)                     # ‚ë† —á–∏—Ç–∞–µ–º
        task["photo_results"][key] = result           # ‚ë° –º–µ–Ω—è–µ–º
        if all(isinstance(v, str) for v in task["photo_results"].values()):
            task["photo_status"] = "done"
        save_task(task_id, task)                      # ‚ë¢ –∞—Ç–æ–º–∏—á–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º

    except Exception as e:
        # –û–±–Ω–æ–≤–∏–º –∑–∞–¥–∞—á—É —Å –ø–æ–º–µ—Ç–∫–æ–π –æ–± –æ—à–∏–±–∫–µ
        try:
            task = load_task(task_id)
        except HTTPException:
            raise                                  # –∫–ª—é—á –ø—Ä–æ–ø–∞–ª ‚Äì –¥–∞–¥–∏–º 404
        task["photo_results"][key] = {"error": str(e)}
        task["photo_status"] = "error"
        save_task(task_id, task)

async def process_survey(task_id: str, survey: SurveyData):
    survey_dict = survey.dict()
    try:
        scores = calculate_survey_scores(survey_dict)
    except Exception as e:
        raise HTTPException(status_code=400, detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –±–∞–ª–ª–æ–≤: {str(e)}")
    
    open_questions = {
        'developmentFeatures': survey_dict.get('developmentFeatures', '') or '',
        'strengths': survey_dict.get('strengths', '') or '',
        'attentionAreas': survey_dict.get('attentionAreas', '') or '',
        'specialists': survey_dict.get('specialists', '') or ''
    }
    
    system_prompt = """–í—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π –æ—Ç–≤–µ—Ç—ã —Ä–æ–¥–∏—Ç–µ–ª–µ–π –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∞–Ω–∫–µ—Ç—ã –æ —Ä–∞–∑–≤–∏—Ç–∏–∏ —Ä–µ–±–µ–Ω–∫–∞, –∞ —Ç–∞–∫ –∂–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—â–∏–π —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    –∑–∞–∫—Ä—ã—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞ –¥–ª—è —Ä–µ–±—ë–Ω–∫–∞ (4 —Ä–∞–∑–¥–µ–ª–∞ –ø–æ 10 –≤–æ–ø—Ä–æ—Å–æ–≤, —à–∫–∞–ª–∞ 1‚Äì5)
    
    ‚öôÔ∏è  –ü—Ä–∞–≤–∏–ª–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
    1. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ (10‚Äì50 –±–∞–ª–ª–æ–≤):
    ‚Ä¢ 10‚Äì19 ‚Äî –Ω–æ—Ä–º–∞ / –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ  
    ‚Ä¢ 20‚Äì29 ‚Äî –ª—ë–≥–∫–∏–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏  
    ‚Ä¢ 30‚Äì39 ‚Äî —É–º–µ—Ä–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏  
    ‚Ä¢ 40‚Äì50 ‚Äî –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏  

    2. –î–ª—è –æ–±—â–µ–π —Å—É–º–º—ã G (40‚Äì200):
    ‚Ä¢ 40‚Äì79  ‚Äî –∑–æ–Ω–∞ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è  
    ‚Ä¢ 80‚Äì119 ‚Äî –∑–æ–Ω–∞ –ø–µ—Ä–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤  
    ‚Ä¢ 120‚Äì159 ‚Äî –∑–æ–Ω–∞ –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã—Ö —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π  
    ‚Ä¢ 160‚Äì200 ‚Äî –∑–æ–Ω–∞ –≤—ã—Å–æ–∫–æ–π —Ç—Ä–µ–≤–æ–≥–∏  

    3. –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —É—Ä–æ–≤–Ω–µ–π:
    ‚Ä¢ –ë–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ ‚Äî —Ä–∞–∑–≤–∏—Ç–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã, —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ —ç–ø–∏–∑–æ–¥–∏—á–Ω—ã.  
    ‚Ä¢ –ü–µ—Ä–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã ‚Äî —É—Å—Ç–æ–π—á–∏–≤—ã–µ, –Ω–æ —É–º–µ—Ä–µ–Ω–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏; –ø—Ä–∏ —Å—Ç—Ä–µ—Å—Å–µ –º–æ–≥—É—Ç —É—Å–∏–ª–∏–≤–∞—Ç—å—Å—è.  
    ‚Ä¢ –í—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ ‚Äî –ø—Ä–æ–±–ª–µ–º—ã –∑–∞–º–µ—Ç–Ω–æ –º–µ—à–∞—é—Ç —É—á—ë–±–µ –∏ –æ–±—â–µ–Ω–∏—é.  
    ‚Ä¢ –í—ã—Å–æ–∫–∞—è —Ç—Ä–µ–≤–æ–≥–∞ ‚Äî —Å–µ—Ä—å—ë–∑–Ω—ã–π –¥–∏—Å—Ç—Ä–µ—Å—Å, –Ω—É–∂–µ–Ω –º–µ–∂–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥.  

    üìù  –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ—Ç–≤–µ—Ç—É  
    ‚Ä¢ –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ —á–µ—Ç—ã—Ä–µ —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞  
    ¬´–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ñ–µ—Ä–∞ ‚Äî 34 –±–∞–ª–ª–∞, —É—Ä–æ–≤–µ–Ω—å: —É–º–µ—Ä–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏¬ª.  
    ‚Ä¢ –ó–∞—Ç–µ–º —Å—Ç—Ä–æ–∫—É ¬´–û–±—â–∞—è —Å—É–º–º–∞: ‚Ä¶ | –£—Ä–æ–≤–µ–Ω—å: ‚Ä¶¬ª  
    —Å –∫—Ä–∞—Ç–∫–∏–º –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º (2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).  
    ‚Ä¢ –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–∞–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (3‚Äì5 –ø—É–Ω–∫—Ç–æ–≤, –∫–∞–∂–¥—ã–π —Å ¬´‚Äì ¬ª).  
    ‚Ä¢ –í—ã–≤–æ–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –±–µ–∑ JSON –∏ Markdown.
    
    """
    user_prompt = f"""
    –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–∫—Ä—ã—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞:

    1. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ñ–µ—Ä–∞: {scores['section_1']}
    2. –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: {scores['section_2']}
    3. –°–∞–º–æ—Ä–µ–≥—É–ª—è—Ü–∏—è –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: {scores['section_3']}
    4. –°–∞–º–æ–æ—Ü–µ–Ω–∫–∞ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {scores['section_4']}
    –û–±—â–∞—è —Å—É–º–º–∞ –±–∞–ª–ª–æ–≤: {scores['total']}

    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –¥–∞–π—Ç–µ –≤—ã–≤–æ–¥ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º system prompt
    
    
    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∞–Ω–∫–µ—Ç—ã:
    1. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–∏—Ç–∏—è –∏–ª–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ä–µ–±–µ–Ω–∫–∞: {open_questions['developmentFeatures']}
    2. –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∏ —Ç–∞–ª–∞–Ω—Ç—ã —Ä–µ–±–µ–Ω–∫–∞: {open_questions['strengths']}
    3. –û–±–ª–∞—Å—Ç–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è: {open_questions['attentionAreas']}
    4. –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º: {open_questions['specialists']}
    –î–∞–π—Ç–µ –∫—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
    """
    
    try:
        analysis = await request_openai(system=system_prompt, user=user_prompt, model='gpt-4.1-mini-2025-04-14', temp=0.1)
    except Exception as e:
        analysis = f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤: {str(e)}"
    
    task = load_task(task_id)
    task.update(
        {
            "name": survey.childName,
            "survey_results": {"scores": scores, "analysis": analysis},
            "survey_status": "done",
        }
    )
    save_task(task_id, task)

def calculate_survey_scores(survey_data: Dict[str, str]) -> Dict[str, int]:
    sections = {
        'section_1': [f'q1_{i}' for i in range(1, 11)],
        'section_2': [f'q2_{i}' for i in range(1, 11)],
        'section_3': [f'q3_{i}' for i in range(1, 11)],
        'section_4': [f'q4_{i}' for i in range(1, 11)]
    }
    scores = {'section_1': 0, 'section_2': 0, 'section_3': 0, 'section_4': 0}
    for section, questions in sections.items():
        for question in questions:
            scores[section] += int(survey_data[question])
    scores['total'] = sum(scores[section] for section in sections.keys())
    return scores

@app.post("/upload")
async def upload_images(files: List[UploadFile] = File(...)):
    if len(files) != 3:
        raise HTTPException(status_code=400, detail="–ù—É–∂–Ω–æ 3 —Ñ–∞–π–ª–∞")
    encoded = []
    for f in files:
        if not f.content_type.startswith('image/'):
            raise HTTPException(status_code=400, detail="–¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")
        data = await f.read()
        b64 = base64.b64encode(data).decode()
        encoded.append((f.content_type, b64))
    task_id = str(uuid.uuid4())
    task_obj = {
        'task_id': task_id,
        'photo_status': 'processing',
        'photo_results': {'image1': None, 'image2': None, 'image3': None},
        'survey_status': 'pending',
        'survey_results': None
    }
    save_task(task_id, task_obj)
    prompts = [PROMPT_HOUSE_TREE_PERSON, PROMPT_ANIMAL, PROMPT_SELF_PORTRAIT]
    for idx, (mime, b64) in enumerate(encoded, start=1):
        key = f'image{idx}'
        asyncio.create_task(process_image(task_id, key, mime, b64, prompts[idx-1]))
    return JSONResponse(status_code=202, content={'task_id': task_id, 'status': '—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ'})

@app.post("/submit-survey")
async def submit_survey(req: AnalysisRequest):
    task_id = req.task_id
    task = load_task(task_id)
    if task["survey_status"] != "pending":
        raise HTTPException(status_code=400, detail="–û–ø—Ä–æ—Å–Ω–∏–∫ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω")
    asyncio.create_task(process_survey(task_id, req.survey))
    return {"message": "–û–ø—Ä–æ—Å–Ω–∏–∫ –ø—Ä–∏–Ω—è—Ç", "task_id": task_id}



@app.get("/report/{task_id}", response_class=JSONResponse)
async def get_report(task_id: str):
    task = load_task(task_id)

    if task["photo_status"] == "done" and task["survey_status"] == "done":
        
        final_system = ''' 
        –¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –æ —Ä–µ–±—ë–Ω–∫–µ.
        
                
                    –ù–∞ –≤—Ö–æ–¥ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å:
            ‚Ä¢ –∫—Ä–∞—Ç–∫–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç –ø–æ –∞–Ω–∫–µ—Ç–µ (survey_results)  
            ‚Ä¢ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä—ë—Ö —Ä–∏—Å—É–Ω–∫–æ–≤ —Ä–µ–±—ë–Ω–∫–∞ (photo_results)  
            ‚Ä¢ –∏–º—è —Ä–µ–±—ë–Ω–∫–∞ (name)  
            –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç.

            ‚ùó –æ—Ç–≤–µ—Ç –¥–∞–≤–∞–π –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –±–µ–∑ Markdown –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.
            ‚ùó –ö–ª—é—á–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º; –∑–Ω–∞—á–µ–Ω–∏—è‚ÄØ‚Äî‚ÄØ–Ω–∞ —Ä—É—Å—Å–∫–æ–º.
            ‚ùó –°–ª–µ–¥—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ —Å—Ç–∏–ª—é –ø—Ä–∏–º–µ—Ä–∞ –Ω–∏–∂–µ (–æ–Ω –ø—Ä–∏–≤–µ–¥—ë–Ω –ª–∏—à—å –∫–∞–∫ –æ–±—Ä–∞–∑–µ—Ü,
            –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞).

            –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ JSON‚Äë–æ—Ç–≤–µ—Ç–∞‚ÄØüëá

            {
            "task_id": "123e4567-e89b-12d3-a456-426614174000",
            "child": {
                "name": "–ê—Ä—Ç—ë–º"
            },

            "summary": {
                "house_quality": "–ß—É–≤—Å—Ç–≤–æ –∑–∞—â–∏—â—ë–Ω–Ω–æ—Å—Ç–∏ –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏",
                "animal_trait":  "–í–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
                "self_portrait": "–°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ —Å–∞–º–æ–∫—Ä–∏—Ç–∏–∫–µ, —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –æ–¥–æ–±—Ä–µ–Ω–∏—é –≤–∑—Ä–æ—Å–ª—ã—Ö"
            },

            "house_tree_person": {
                "elements": [
                { "element": "–î–æ–º",     "features": "–£—é—Ç–Ω—ã–π, —Å –æ–∫–Ω–∞–º–∏, –¥—ã–º–æ–º, –∑–∞–±–æ—Ä–æ–º",    "conclusion": "–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Å–µ–º—å—è –≤–∞–∂–Ω–∞" },
                { "element": "–î–µ—Ä–µ–≤–æ",  "features": "–° –∫–æ—Ä–Ω—è–º–∏, –ø—ã—à–Ω–∞—è –∫—Ä–æ–Ω–∞",             "conclusion": "–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —Ä–æ—Å—Ç, –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è"   },
                { "element": "–ß–µ–ª–æ–≤–µ–∫", "features": "–ú–∞–ª–µ–Ω—å–∫–∏–π, —Ä—É–∫–∏ –ø—Ä–∏–∂–∞—Ç—ã, –±–µ–∑ —ç–º–æ—Ü–∏–π", "conclusion": "–°–∫—Ä–æ–º–Ω–æ—Å—Ç—å, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Å–¥–µ—Ä–∂–∞–Ω–Ω–æ—Å—Ç—å" }
                ],
                "overall": "–†–µ–±—ë–Ω–æ–∫ —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–µ–±—è –≤ —Å–µ–º—å–µ –∑–∞—â–∏—â—ë–Ω–Ω–æ, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–¥–µ—Ä–∂–∞–Ω –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ —ç–º–æ—Ü–∏–π –∏ —á—É–≤—Å—Ç–≤—É–µ—Ç –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ."
            },

            "animal": {
                "choice":     "–§–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–æ–µ —Å—É—â–µ—Å—Ç–≤–æ (–ª–∏—Å–∞ —Å –∫—Ä—ã–ª—å—è–º–∏)",
                "accents":    "–ë–æ–ª—å—à–∏–µ –≥–ª–∞–∑–∞, —É—à–∏ ‚Äî –≤–∞–∂–Ω–æ—Å—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏—è",
                "pose":       "–°–∏–¥—è—á–∞—è –ø–æ–∑–∞, –º–∏—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ",
                "conclusion": "–•–æ—Ä–æ—à–æ —Ä–∞–∑–≤–∏—Ç–æ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏"
            },

            "self_portrait": {
                "size":       "–ú–∞–ª–µ–Ω—å–∫–∏–π",
                "face":       "–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ",
                "details":    "–ù–µ—Ç —Ñ–æ–Ω–∞ –∏–ª–∏ –≤—Ç–æ—Ä–∏—á–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤",
                "conclusion": "–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –≤–Ω–µ—à–Ω—é—é –æ—Ü–µ–Ω–∫—É, –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ"
            },

            "questionnaire": {
                "scales": [
                { "name": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å", "score": 22, "transcript": "–ª—ë–≥–∫–∏–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏"},
                { "name": "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è",       "score": 32, "transcript": "—É–º–µ—Ä–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏"},
                { "name": "–°–∞–º–æ—Ä–µ–≥—É–ª—è—Ü–∏—è",              "score": 12, "transcript": "–Ω–æ—Ä–º–∞ / –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ"},
                { "name": "–°–∞–º–æ–æ—Ü–µ–Ω–∫–∞",                 "score": 42, "transcript": "–≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏."},
                { "name": "–û–±—â–µ–µ",                      "score": 108, "transcript": "–∑–æ–Ω–∞ –ø–µ—Ä–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤."}
                ]
            },
            
             "transcript_questionnaire": {
                "scales": [
                    –í —Ü–µ–ª–æ–º —É —Ä–µ–±—ë–Ω–∫–∞ –∏–º–µ—é—Ç—Å—è —É—Å—Ç–æ–π—á–∏–≤—ã–µ, –Ω–æ —É–º–µ—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ –∏ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–µ, —á—Ç–æ –º–æ–∂–µ—Ç —É—Å—É–≥—É–±–ª—è—Ç—å—Å—è –ø—Ä–∏ —Å—Ç—Ä–µ—Å—Å–∞—Ö.
                    
                    –ê–Ω–∞–ª–∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ä–µ–±–µ–Ω–æ–∫ –≥–∏–ø–µ—Ä–∞–∫—Ç–∏–≤–µ–Ω, —á—Ç–æ –º–æ–∂–µ—Ç –æ—Å–ª–æ–∂–Ω—è—Ç—å –µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é. –¢–∞–ª–∞–Ω—Ç—ã –≤ —Ç–∞–Ω—Ü–∞—Ö –∏ –ø–µ–Ω–∏–∏ 
                    —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É—é—Ç –æ —Ä–∞–∑–≤–∏—Ç—ã—Ö —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è—Ö. –û—Ç–º–µ—á–∞–µ—Ç—Å—è –Ω–µ–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –æ–±—â–µ–Ω–∏—é, —á—Ç–æ —Å–æ–≥–ª–∞—Å—É–µ—Ç—Å—è —Å —É–º–µ—Ä–µ–Ω–Ω—ã–º–∏
                    —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏. –†–∞–Ω–µ–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –Ω–µ –ø—Ä–∏–≤–ª–µ–∫–∞–ª–∏—Å—å, —á—Ç–æ –≤–∞–∂–Ω–æ —É—á–µ—Å—Ç—å.
                ]
            },

            "recommendations": [
                "–ß–∞—â–µ —Ö–≤–∞–ª–∏—Ç–µ —Ä–µ–±—ë–Ω–∫–∞ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç",
                "–ü–æ–º–æ–≥–∞–π—Ç–µ –Ω–∞–∑—ã–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∞: \"–¢—ã —Ä–∞—Å—Å—Ç—Ä–æ–∏–ª—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ...\"",
                "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É, –¥–∞–∂–µ –µ—Å–ª–∏ —Ä–µ–±—ë–Ω–æ–∫ –æ—à–∏–±–∞–µ—Ç—Å—è",
                "–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–ø–æ–∫–æ–π–Ω—É—é –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –¥–æ–º–∞",
                "–ü–æ–æ—â—Ä—è–π—Ç–µ —Ñ–∞–Ω—Ç–∞–∑–∏—é ‚Äî —Å–∫–∞–∑–∫–∏, —Ä–∏—Å—É–Ω–∫–∏, –∏–≥—Ä—ã –ø–æ —Ä–æ–ª—è–º"
            ],

            "disclaimer": "–û—Ç—á—ë—Ç —Å–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–µ–∫—Ç–Ω—ã—Ö –º–µ—Ç–æ–¥–∏–∫ –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π. –Ø–≤–ª—è–µ—Ç—Å—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–º –¥–ª—è –º—è–≥–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ–±—ë–Ω–∫–∞ –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏."
            }
                
        '''

        final_user = f'''    
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ –∫–∞–∫ –æ–ø—ã—Ç–Ω–æ–≥–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∞, –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –æ —Ä–µ–±—ë–Ω–∫–µ.
               
        
–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–±—ë–Ω–∫–µ:
–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç –æ —Ä–µ–±—ë–Ω–∫–µ: {task["survey_results"]}
—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä—ë—Ö —Ä–∏—Å—É–Ω–∫–æ–≤ —Ä–µ–±—ë–Ω–∫–∞ : {task["photo_results"]}
–∏–º—è —Ä–µ–±–µ–Ω–∫–∞: {task["name"]}

–æ–±—ä–µ–¥–∏–Ω–∏ –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ json
               
        
        '''
        
       
        try:
            openai_report = await request_openai(system=final_system, user=final_user, model='gpt-4.1-mini-2025-04-14', temp=0)
            print('OpenAI Report Generated:')
            print('--------------------------------------------')
            print(openai_report)
            print('--------------------------------------------')
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–∞ OpenAI
            #pdf_filename = await generate_pdf_from_openai_response(task, openai_report)
            
            #if not os.path.exists(pdf_filename):
            #    raise HTTPException(status_code=500, detail="PDF —Ñ–∞–π–ª –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω")
            task["final_report"] = openai_report
            save_task(task_id, task)

            return {"report": openai_report}
                #pdf_filename, 
                #media_type='application/pdf', 
                #filename=f"report_{task_id}.pdf"
            
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞: {str(e)}")
    elif task['photo_status'] == 'error' or task['survey_status'] == 'error':
        return {"status": "error", "errors": task.get('photo_results', {}) | task.get('survey_results', {})}
    else:
        return {"status": "inProgress"}
    
    